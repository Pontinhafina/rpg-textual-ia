<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG Textual: Mestre IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400..900&family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&display=swap');
        
        :root {
            --primary-dark: #1a1f2e;
            --primary-medium: #2a3245;
            --primary-light: #3a445c;
            --accent-gold: #d4af37;
            --accent-red: #c41e3a;
            --accent-blue: #1e90ff;
            --text-light: #f5f5f5;
            --text-dim: #b8b8b8;
        }
        
        body {
            font-family: 'Merriweather', serif;
            background-color: var(--primary-dark);
            color: var(--text-light);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(42, 50, 69, 0.5) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(42, 50, 69, 0.5) 0%, transparent 20%);
        }

        #main-header {
            background: linear-gradient(145deg, var(--primary-medium) 0%, var(--primary-dark) 100%);
            border: 2px solid var(--accent-gold);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5), inset 0 0 10px rgba(212, 175, 55, 0.2);
        }
        
        #main-header h1 {
            font-family: 'Cinzel', serif; 
            font-size: 1.5rem; 
            text-shadow: 0 0 8px var(--accent-gold), 0 0 15px rgba(212, 175, 55, 0.6); 
            color: var(--accent-gold);
        }
        
        @media (min-width: 768px) {
            #main-header h1 {
                font-size: 2.5rem;
            }
        }
        
        #character-name-display { 
            color: var(--accent-gold); 
            text-shadow: 0 0 3px rgba(212, 175, 55, 0.3); 
            font-size: 0.8rem;
        }

        /* Chat area styling */
        #chat-area { 
            background-color: #1e1a1a;
            color: var(--text-light); 
            border: 2px solid #3a2e2a;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
            height: 50vh;
        }
        
        @media (min-width: 768px) {
            #chat-area {
                height: 60vh;
            }
        }
        
        .message-box { 
            border-radius: 12px; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3); 
            padding: 1rem 1.5rem; 
            margin-bottom: 1rem;
            max-width: 90%;
            word-wrap: break-word;
        }
        
        .user-message { 
            background: linear-gradient(135deg, #2a3c5f 0%, #1e2a47 100%);
            color: var(--text-light); 
            margin-left: auto; 
            border: 1px solid #3a5278;
        }
        
        .ai-message { 
            background: linear-gradient(135deg, #3a2e2a 0%, #2a221f 100%);
            color: var(--text-light); 
            border-left: 6px solid var(--accent-gold);
            margin-right: auto; 
        }

        .combat-message {
            background: linear-gradient(135deg, #5a2e2e 0%, #3a1e1e 100%);
            border-left: 6px solid var(--accent-red);
        }

        .level-up-message {
            background: linear-gradient(135deg, #2e5a3a 0%, #1e3a2a 100%);
            border-left: 6px solid #44ff44;
        }

        .spell-message {
            background: linear-gradient(135deg, #2e3a5a 0%, #1e2a3a 100%);
            border-left: 6px solid var(--accent-blue);
        }

        /* Input and Button theme - CORRIGIDO PARA CELULAR */
        #user-input { 
            background-color: #2a221f; 
            border: 2px solid #3a2e2a; 
            color: var(--text-light); 
            font-size: 16px; /* Evita zoom no iOS */
            padding: 1rem;
            height: auto;
            min-height: 60px;
        }
        
        #send-button { 
            background: linear-gradient(135deg, var(--accent-gold) 0%, #b8941f 100%);
            color: var(--primary-dark); 
            border: 1px solid var(--accent-gold);
            padding: 1rem 1.5rem;
            white-space: nowrap;
        }

        .combat-button {
            background: linear-gradient(135deg, var(--accent-red) 0%, #a61e3a 100%);
            color: white;
            border: 1px solid var(--accent-red);
            padding: 0.75rem;
            font-size: 0.9rem;
        }

        .skill-button {
            background: linear-gradient(135deg, var(--accent-blue) 0%, #1e70ff 100%);
            color: white;
            border: 1px solid var(--accent-blue);
            padding: 0.75rem;
            font-size: 0.9rem;
        }

        .spell-button {
            background: linear-gradient(135deg, #8a2be2 0%, #6a1bb2 100%);
            color: white;
            border: 1px solid #8a2be2;
            padding: 0.75rem;
            font-size: 0.9rem;
        }

        /* Modal styling */
        #character-setup, #skills-modal, #relationships-modal, #attributes-modal, #music-modal { 
            z-index: 70; 
        }
        
        .modal-content { 
            background: linear-gradient(135deg, var(--primary-medium) 0%, var(--primary-dark) 100%);
            border: 2px solid var(--accent-gold); 
            max-height: 90vh;
            overflow-y: auto;
            margin: 1rem;
        }
        
        .modal-content h2 { 
            color: var(--accent-gold); 
        }

        /* Sidebar styling - MELHORADO PARA CELULAR */
        #sidebar { 
            position: fixed; 
            top: 0; 
            left: 0; 
            height: 100%; 
            width: 280px; 
            transform: translateX(-100%); 
            transition: transform 0.3s ease-in-out; 
            z-index: 50; 
            overflow-y: auto; 
            background: linear-gradient(135deg, var(--primary-medium) 0%, var(--primary-dark) 100%);
            border-right: 2px solid var(--accent-gold);
            padding-top: 4rem;
        }
        
        #sidebar.open { transform: translateX(0); }
        
        @media (min-width: 768px) { 
            #sidebar { 
                position: relative; 
                transform: translateX(0); 
                min-width: 300px; 
                width: 300px; 
                padding-top: 1rem;
            } 
        }
        
        #sidebar-toggle { 
            display: block; 
            position: fixed; 
            left: 1rem; 
            top: 1rem; 
            z-index: 60; 
            background-color: var(--accent-gold); 
            color: var(--primary-dark); 
            padding: 0.5rem; 
            border-radius: 50%; 
            width: 40px;
            height: 40px;
        }
        
        @media (min-width: 768px) { 
            #sidebar-toggle { display: none; } 
        }
        
        .sidebar-section { 
            background-color: rgba(35, 45, 60, 0.8); 
            border: 1px solid #5a4b3f; 
            border-radius: 8px; 
            padding: 0.75rem; 
            margin-bottom: 0.75rem; 
            font-size: 0.9rem;
        }
        
        .sidebar-section h3 { 
            font-family: 'Cinzel', serif; 
            color: var(--accent-gold); 
            font-size: 1.1rem; 
            margin-bottom: 0.5rem; 
        }

        /* Header buttons - AJUSTADO PARA CELULAR */
        .header-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            justify-content: center;
            margin-top: 0.5rem;
        }

        .header-button {
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            font-size: 0.7rem;
            white-space: nowrap;
        }

        /* Combat UI - AJUSTADO PARA CELULAR */
        #combat-ui {
            transition: all 0.3s ease;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .combat-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .skills-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        @media (min-width: 768px) {
            .skills-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Input section - CORRIGIDO */
        .input-section {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
            align-items: flex-end;
        }

        #user-input {
            flex: 1;
            min-height: 60px;
        }

        #send-button {
            height: fit-content;
            padding: 1rem 1.2rem;
        }

        /* Character creation - MELHORADO PARA CELULAR */
        .creation-section {
            margin-bottom: 1rem;
        }

        .creation-section-title {
            font-family: 'Cinzel', serif;
            color: var(--accent-gold);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
            padding-bottom: 0.25rem;
        }

        .class-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .class-card {
            background: rgba(42, 50, 69, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 0.5rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .class-card:hover {
            background: rgba(42, 50, 69, 1);
            border-color: var(--accent-gold);
            transform: translateY(-2px);
        }

        .class-card.selected {
            border-color: var(--accent-gold);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
            background: rgba(42, 50, 69, 1);
        }

        .class-icon-small {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .class-name {
            font-weight: bold;
            font-size: 0.8rem;
            margin-bottom: 0.25rem;
        }

        .class-desc {
            font-size: 0.65rem;
            color: var(--text-dim);
            line-height: 1.2;
        }

        /* Multiplayer styles */
        .online-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }

        .online {
            background-color: #44ff44;
            box-shadow: 0 0 5px #44ff44;
        }

        .offline {
            background-color: #ff4444;
        }

        .game-mode-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .mode-button {
            flex: 1;
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-button.active {
            border: 2px solid var(--accent-gold);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .singleplayer-mode {
            background: linear-gradient(135deg, #2a5a3a 0%, #1e3a2a 100%);
        }

        .multiplayer-mode {
            background: linear-gradient(135deg, #3a2a5a 0%, #2a1e3a 100%);
        }

        /* Progress bars */
        .progress-container {
            width: 100%;
            height: 12px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            overflow: hidden;
            margin-top: 4px;
        }

        .progress-bar {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        .hp-bar {
            background: linear-gradient(90deg, #c41e3a, #ff6b6b);
        }

        .mp-bar {
            background: linear-gradient(90deg, #1e90ff, #6bc5ff);
        }

        .xp-bar {
            background: linear-gradient(90deg, #d4af37, #ffd700);
        }

        /* Skills tree */
        .skill-node {
            background: rgba(42, 50, 69, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .skill-node:hover {
            background: rgba(42, 50, 69, 1);
            border-color: var(--accent-gold);
        }

        .skill-node.unlocked {
            border-color: var(--accent-gold);
            box-shadow: 0 0 5px rgba(212, 175, 55, 0.5);
        }

        .skill-node.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .skill-node.available {
            border-color: var(--accent-blue);
            box-shadow: 0 0 5px rgba(30, 144, 255, 0.5);
        }

        /* Relationships */
        .relationship-card {
            background: rgba(42, 50, 69, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .relationship-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .relationship-level {
            height: 8px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 4px;
        }

        .relationship-fill {
            height: 100%;
            border-radius: 4px;
            background: linear-gradient(90deg, #8a2be2, #b19cd9);
        }

        /* Story mode selector */
        .story-mode-selector {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .story-mode-card {
            background: rgba(42, 50, 69, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .story-mode-card:hover {
            background: rgba(42, 50, 69, 1);
            transform: translateY(-2px);
        }

        .story-mode-card.selected {
            border-color: var(--accent-gold);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
            background: rgba(42, 50, 69, 1);
        }

        .story-mode-title {
            font-family: 'Cinzel', serif;
            color: var(--accent-gold);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .story-mode-desc {
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        /* Attributes system */
        .attributes-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }

        .attribute-card {
            background: rgba(42, 50, 69, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 0.5rem;
            text-align: center;
        }

        .attribute-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-gold);
            margin: 0.25rem 0;
        }

        .attribute-name {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .attribute-desc {
            font-size: 0.65rem;
            color: var(--text-dim);
            margin-top: 0.25rem;
        }

        .attribute-points {
            text-align: center;
            margin: 1rem 0;
            padding: 0.5rem;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 6px;
            border: 1px solid var(--accent-gold);
        }

        .attribute-points-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-gold);
        }

        /* Choice buttons */
        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .choice-button {
            background: linear-gradient(135deg, #3a445c 0%, #2a3245 100%);
            border: 1px solid var(--accent-gold);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: var(--text-light);
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .choice-button:hover {
            background: linear-gradient(135deg, #4a547c 0%, #3a4255 100%);
            transform: translateX(5px);
        }

        .choice-letter {
            display: inline-block;
            width: 24px;
            height: 24px;
            background: var(--accent-gold);
            color: var(--primary-dark);
            border-radius: 50%;
            text-align: center;
            font-weight: bold;
            margin-right: 0.5rem;
            line-height: 24px;
        }

        /* Music player */
        .music-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .volume-slider {
            width: 100px;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: var(--accent-gold);
            border-radius: 50%;
            cursor: pointer;
        }

        /* World introduction */
        .world-intro {
            background: linear-gradient(135deg, #2a3c5f 0%, #1e2a47 100%);
            border: 1px solid var(--accent-blue);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .world-title {
            font-family: 'Cinzel', serif;
            color: var(--accent-gold);
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .world-description {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        /* Music selection */
        .music-selection {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .music-option {
            background: rgba(42, 50, 69, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .music-option:hover {
            background: rgba(42, 50, 69, 1);
            border-color: var(--accent-gold);
        }

        .music-option.selected {
            border-color: var(--accent-gold);
            box-shadow: 0 0 5px rgba(212, 175, 55, 0.5);
        }

        /* Loading indicator */
        .loading-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--accent-gold);
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="h-screen overflow-hidden">

    <div class="flex flex-col h-full md:flex-row">

        <aside id="sidebar" class="p-4 flex flex-col pt-16">
            <h2 class="text-2xl font-bold text-center mb-6" style="font-family: 'Cinzel', serif; color: var(--accent-gold);">Detalhes da Aventura</h2>

            <!-- Se√ß√£o Modo de Jogo -->
            <div class="sidebar-section">
                <h3>Modo de Jogo</h3>
                <div class="game-mode-buttons">
                    <div class="mode-button singleplayer-mode active" id="singleplayer-btn">
                        üéØ Singleplayer
                    </div>
                    <div class="mode-button multiplayer-mode" id="multiplayer-btn">
                        üéÆ Multiplayer
                    </div>
                </div>
                <div id="multiplayer-info" class="text-sm">
                    <p class="text-gray-400 italic">Modo singleplayer ativo</p>
                </div>
            </div>

            <!-- Se√ß√£o Personagem -->
            <div class="sidebar-section">
                <h3>Personagem</h3>
                <p><strong>Nome:</strong> <span id="sidebar-char-name" class="text-yellow-300">-</span></p>
                <p><strong>Classe:</strong> <span id="sidebar-char-role" class="text-white">-</span></p>
                <p><strong>N√≠vel:</strong> <span id="sidebar-char-level" class="text-green-400">1</span></p>
                <p><strong>XP:</strong> <span id="sidebar-char-xp">0/100</span></p>
                <div class="progress-container">
                    <div id="xp-bar" class="progress-bar xp-bar" style="width: 0%"></div>
                </div>
            </div>

            <!-- Se√ß√£o Atributos -->
            <div class="sidebar-section">
                <h3>Atributos</h3>
                <div class="attributes-grid">
                    <div class="attribute-card">
                        <div class="attribute-name">For√ßa</div>
                        <div class="attribute-value" id="attr-strength">10</div>
                    </div>
                    <div class="attribute-card">
                        <div class="attribute-name">Destreza</div>
                        <div class="attribute-value" id="attr-dexterity">10</div>
                    </div>
                    <div class="attribute-card">
                        <div class="attribute-name">Constitui√ß√£o</div>
                        <div class="attribute-value" id="attr-constitution">10</div>
                    </div>
                    <div class="attribute-card">
                        <div class="attribute-name">Intelig√™ncia</div>
                        <div class="attribute-value" id="attr-intelligence">10</div>
                    </div>
                    <div class="attribute-card">
                        <div class="attribute-name">Sabedoria</div>
                        <div class="attribute-value" id="attr-wisdom">10</div>
                    </div>
                    <div class="attribute-card">
                        <div class="attribute-name">Carisma</div>
                        <div class="attribute-value" id="attr-charisma">10</div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o Vitalidade CORRIGIDA -->
            <div class="sidebar-section">
                <h3>Vitalidade</h3>
                <div class="space-y-2">
                    <div>
                        <p class="flex justify-between items-center text-red-400 text-sm">
                            <span>HP</span>
                            <span id="hp-value">100/100</span>
                        </p>
                        <div class="progress-container">
                            <div id="hp-bar" class="progress-bar hp-bar" style="width: 100%"></div>
                        </div>
                    </div>
                    <div>
                        <p class="flex justify-between items-center text-blue-400 text-sm">
                            <span>MP</span>
                            <span id="mp-value">50/50</span>
                        </p>
                        <div class="progress-container">
                            <div id="mp-bar" class="progress-bar mp-bar" style="width: 100%"></div>
                        </div>
                    </div>
                    <div>
                        <p class="flex justify-between items-center text-green-400 text-sm">
                            <span>Stamina</span>
                            <span id="stamina-value">100/100</span>
                        </p>
                        <div class="progress-container">
                            <div id="stamina-bar" class="progress-bar" style="width: 100%; background: linear-gradient(90deg, #2ecc71, #27ae60);"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o Habilidades -->
            <div class="sidebar-section">
                <h3>Habilidades</h3>
                <ul id="skills-list" class="text-sm">
                    <li class="text-gray-400 italic">Nenhuma habilidade aprendida</li>
                </ul>
            </div>

            <!-- Se√ß√£o Relacionamentos -->
            <div class="sidebar-section">
                <h3>Relacionamentos</h3>
                <div id="relationships-list">
                    <p class="text-gray-400 italic text-sm">Ainda n√£o conheceu ningu√©m</p>
                </div>
            </div>

            <!-- Se√ß√£o Invent√°rio -->
            <div class="sidebar-section">
                <h3>Invent√°rio</h3>
                <ul id="inventory-list" class="text-sm">
                    <li class="text-gray-400 italic">Invent√°rio vazio</li>
                </ul>
            </div>

        </aside>

        <button id="sidebar-toggle">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                <path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1 0-1.5Z" clip-rule="evenodd" />
            </svg>
        </button>

        <div class="flex flex-col flex-grow p-2 md:p-4 h-full">
            <header id="main-header" class="text-center p-3 rounded-xl mb-2">
                <h1 class="tracking-wider">RPG Textual</h1>
                <div class="text-xs mt-1">
                    <p>Jogador: <span id="character-name-display" class="font-bold">...</span></p>
                    <div class="header-buttons">
                        <button id="audio-toggle-button" class="header-button bg-gray-700 hover:bg-gray-600 text-white">
                            üéµ M√∫sica
                        </button>
                        <button id="reset-game-button" class="header-button bg-red-700 hover:bg-red-600 text-white">
                            üîÑ Novo
                        </button>
                        <button id="save-game-button" class="header-button bg-green-700 hover:bg-green-600 text-white">
                            üíæ Salvar
                        </button>
                        <button id="skills-modal-button" class="header-button bg-purple-700 hover:bg-purple-600 text-white">
                            üå≥ Skills
                        </button>
                        <button id="relationships-modal-button" class="header-button bg-pink-700 hover:bg-pink-600 text-white">
                            üíù Rela√ß√µes
                        </button>
                        <button id="attributes-modal-button" class="header-button bg-blue-700 hover:bg-blue-600 text-white">
                            üìä Atributos
                        </button>
                    </div>
                </div>
            </header>

            <!-- Interface de Combate -->
            <div id="combat-ui" class="hidden mb-3 p-3 rounded-xl bg-gray-800 border-2 border-red-600">
                <div class="text-center mb-3">
                    <h3 class="text-lg font-bold text-red-400 mb-1" id="enemy-name">Inimigo</h3>
                    <p class="text-xs text-gray-300" id="enemy-level">N√≠vel: 1</p>
                </div>
                
                <div class="combat-actions">
                    <button id="attack-btn" class="combat-button">
                        ‚öîÔ∏è Atacar
                    </button>
                    <button id="skill-btn" class="skill-button">
                        üéØ Skills
                    </button>
                    <button id="defend-btn" class="bg-gray-600 text-white py-2 px-4 rounded-lg font-bold text-sm">
                        üõ°Ô∏è Defender
                    </button>
                    <button id="flee-btn" class="bg-yellow-600 text-white py-2 px-4 rounded-lg font-bold text-sm">
                        üèÉ Fugir
                    </button>
                </div>

                <div class="mt-3 hidden" id="skills-section">
                    <h4 class="text-base font-bold text-purple-400 mb-1">üîÆ Habilidades</h4>
                    <div class="skills-grid" id="skills-grid">
                        <!-- Habilidades ser√£o adicionadas dinamicamente aqui -->
                    </div>
                </div>
            </div>

            <!-- Modal de Cria√ß√£o de Personagem -->
            <div id="character-setup" class="fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-2">
                <div class="modal-content p-4 rounded-xl w-full max-w-md">
                    <div class="text-center mb-4">
                        <h2 class="text-2xl font-bold mb-1" style="font-family: 'Cinzel', serif; color: var(--accent-gold);">Crie Seu Personagem</h2>
                        <p class="text-sm text-gray-300">Escolha seu modo de jogo e personagem</p>
                    </div>
                    
                    <!-- Sele√ß√£o de Modo -->
                    <div class="creation-section">
                        <h3 class="creation-section-title">Modo de Jogo</h3>
                        <div class="game-mode-buttons">
                            <div class="mode-button singleplayer-mode active" id="setup-singleplayer-btn">
                                üéØ Singleplayer
                            </div>
                            <div class="mode-button multiplayer-mode" id="setup-multiplayer-btn">
                                üéÆ Multiplayer
                            </div>
                        </div>
                    </div>

                    <!-- Sele√ß√£o de Modo de Hist√≥ria -->
                    <div class="creation-section">
                        <h3 class="creation-section-title">Modo de Hist√≥ria</h3>
                        <div class="story-mode-selector">
                            <div class="story-mode-card selected" data-mode="sandbox">
                                <div class="story-mode-title">üèûÔ∏è Sandbox Livre</div>
                                <div class="story-mode-desc">Explore um mundo aberto com total liberdade para criar sua pr√≥pria hist√≥ria. Sem limites para sua criatividade!</div>
                            </div>
                            <div class="story-mode-card" data-mode="narrative">
                                <div class="story-mode-title">üìñ Narrativa Guiada</div>
                                <div class="story-mode-desc">Siga uma hist√≥ria complexa e bem estruturada com personagens profundos e reviravoltas emocionantes.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <!-- Nome do Personagem -->
                        <div class="creation-section">
                            <h3 class="creation-section-title">Nome do Personagem</h3>
                            <div class="space-y-2">
                                <input type="text" id="char-name-input" placeholder="Ex: Corvo, o Bardo" class="w-full p-2 rounded-lg bg-gray-800 text-white border border-gray-600 text-sm">
                                <div class="grid grid-cols-2 gap-2">
                                    <input type="number" id="char-age-input" placeholder="Idade" min="15" max="150" class="p-2 rounded-lg bg-gray-800 text-white border border-gray-600 text-sm">
                                    <select id="char-sex-input" class="p-2 rounded-lg bg-gray-800 text-white border border-gray-600 text-sm">
                                        <option value="">Sexo</option>
                                        <option value="Masculino">Masculino</option>
                                        <option value="Feminino">Feminino</option>
                                        <option value="N√£o-bin√°rio">N√£o-bin√°rio</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Escolha da Classe -->
                        <div class="creation-section">
                            <h3 class="creation-section-title">Escolha sua Classe</h3>
                            <div class="class-grid">
                                <div class="class-card" data-class="Guerreiro">
                                    <div class="class-icon-small">‚öîÔ∏è</div>
                                    <div class="class-name">Guerreiro</div>
                                    <div class="class-desc">Combate corpo a corpo</div>
                                </div>
                                <div class="class-card" data-class="Mago">
                                    <div class="class-icon-small">üîÆ</div>
                                    <div class="class-name">Mago</div>
                                    <div class="class-desc">Artes arcanas</div>
                                </div>
                                <div class="class-card" data-class="Arqueiro">
                                    <div class="class-icon-small">üèπ</div>
                                    <div class="class-name">Arqueiro</div>
                                    <div class="class-desc">Ataques √† dist√¢ncia</div>
                                </div>
                                <div class="class-card" data-class="Ladino">
                                    <div class="class-icon-small">üó°Ô∏è</div>
                                    <div class="class-name">Ladino</div>
                                    <div class="class-desc">Furtividade</div>
                                </div>
                                <div class="class-card" data-class="Paladino">
                                    <div class="class-icon-small">üõ°Ô∏è</div>
                                    <div class="class-name">Paladino</div>
                                    <div class="class-desc">Poderes divinos</div>
                                </div>
                                <div class="class-card" data-class="Bardo">
                                    <div class="class-icon-small">üéµ</div>
                                    <div class="class-name">Bardo</div>
                                    <div class="class-desc">Magia musical</div>
                                </div>
                                <div class="class-card" data-class="Druida">
                                    <div class="class-icon-small">üåø</div>
                                    <div class="class-name">Druida</div>
                                    <div class="class-desc">Natureza</div>
                                </div>
                                <div class="class-card" data-class="Necromante">
                                    <div class="class-icon-small">üíÄ</div>
                                    <div class="class-name">Necromante</div>
                                    <div class="class-desc">Artes das trevas</div>
                                </div>
                            </div>
                        </div>

                        <!-- Distribui√ß√£o de Atributos -->
                        <div class="creation-section">
                            <h3 class="creation-section-title">Atributos do Personagem</h3>
                            <div class="attribute-points">
                                <p class="text-sm">Pontos de Atributo Dispon√≠veis:</p>
                                <div class="attribute-points-value" id="attribute-points">15</div>
                            </div>
                            <div class="attributes-grid">
                                <div class="attribute-card">
                                    <div class="attribute-name">For√ßa</div>
                                    <div class="attribute-value" id="create-strength">10</div>
                                    <div class="flex justify-center gap-2 mt-1">
                                        <button class="attribute-minus bg-red-600 text-white w-6 h-6 rounded text-xs" data-attribute="strength">-</button>
                                        <button class="attribute-plus bg-green-600 text-white w-6 h-6 rounded text-xs" data-attribute="strength">+</button>
                                    </div>
                                    <div class="attribute-desc">Ataque f√≠sico</div>
                                </div>
                                <div class="attribute-card">
                                    <div class="attribute-name">Destreza</div>
                                    <div class="attribute-value" id="create-dexterity">10</div>
                                    <div class="flex justify-center gap-2 mt-1">
                                        <button class="attribute-minus bg-red-600 text-white w-6 h-6 rounded text-xs" data-attribute="dexterity">-</button>
                                        <button class="attribute-plus bg-green-600 text-white w-6 h-6 rounded text-xs" data-attribute="dexterity">+</button>
                                    </div>
                                    <div class="attribute-desc">Precis√£o e agilidade</div>
                                </div>
                                <div class="attribute-card">
                                    <div class="attribute-name">Constitui√ß√£o</div>
                                    <div class="attribute-value" id="create-constitution">10</div>
                                    <div class="flex justify-center gap-2 mt-1">
                                        <button class="attribute-minus bg-red-600 text-white w-6 h-6 rounded text-xs" data-attribute="constitution">-</button>
                                        <button class="attribute-plus bg-green-600 text-white w-6 h-6 rounded text-xs" data-attribute="constitution">+</button>
                                    </div>
                                    <div class="attribute-desc">Vida e resist√™ncia</div>
                                </div>
                                <div class="attribute-card">
                                    <div class="attribute-name">Intelig√™ncia</div>
                                    <div class="attribute-value" id="create-intelligence">10</div>
                                    <div class="flex justify-center gap-2 mt-1">
                                        <button class="attribute-minus bg-red-600 text-white w-6 h-6 rounded text-xs" data-attribute="intelligence">-</button>
                                        <button class="attribute-plus bg-green-600 text-white w-6 h-6 rounded text-xs" data-attribute="intelligence">+</button>
                                    </div>
                                    <div class="attribute-desc">Magia e conhecimento</div>
                                </div>
                                <div class="attribute-card">
                                    <div class="attribute-name">Sabedoria</div>
                                    <div class="attribute-value" id="create-wisdom">10</div>
                                    <div class="flex justify-center gap-2 mt-1">
                                        <button class="attribute-minus bg-red-600 text-white w-6 h-6 rounded text-xs" data-attribute="wisdom">-</button>
                                        <button class="attribute-plus bg-green-600 text-white w-6 h-6 rounded text-xs" data-attribute="wisdom">+</button>
                                    </div>
                                    <div class="attribute-desc">Percep√ß√£o e intui√ß√£o</div>
                                </div>
                                <div class="attribute-card">
                                    <div class="attribute-name">Carisma</div>
                                    <div class="attribute-value" id="create-charisma">10</div>
                                    <div class="flex justify-center gap-2 mt-1">
                                        <button class="attribute-minus bg-red-600 text-white w-6 h-6 rounded text-xs" data-attribute="charisma">-</button>
                                        <button class="attribute-plus bg-green-600 text-white w-6 h-6 rounded text-xs" data-attribute="charisma">+</button>
                                    </div>
                                    <div class="attribute-desc">Persuas√£o e lideran√ßa</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-600 mt-4 pt-3 text-center">
                        <button id="save-character-button" class="w-full font-bold py-2 rounded-lg bg-yellow-600 hover:bg-yellow-700 text-white text-base">
                            Come√ßar Aventura!
                        </button>
                    </div>
                </div>
            </div>

            <!-- Modal de M√∫sica -->
            <div id="music-modal" class="fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-2 hidden">
                <div class="modal-content p-4 rounded-xl w-full max-w-md">
                    <div class="text-center mb-4">
                        <h2 class="text-2xl font-bold mb-1" style="font-family: 'Cinzel', serif; color: var(--accent-gold);">Configura√ß√µes de M√∫sica</h2>
                        <p class="text-sm text-gray-300">Escolha a trilha sonora da sua aventura</p>
                    </div>
                    
                    <div class="music-selection">
                        <div class="music-option selected" data-music="none">
                            üîá Sem M√∫sica (Recomendado)
                        </div>
                        <div class="music-option" data-music="ambient">
                            üå≤ Ambiente Suave
                        </div>
                    </div>
                    
                    <div class="music-controls mt-4">
                        <span class="text-sm">Volume:</span>
                        <input type="range" min="0" max="100" value="50" class="volume-slider" id="volume-slider">
                        <span class="text-sm" id="volume-value">50%</span>
                    </div>
                    
                    <div class="border-t border-gray-600 mt-4 pt-3 text-center">
                        <button id="close-music-button" class="font-bold py-2 px-4 rounded-lg bg-gray-600 hover:bg-gray-700 text-white text-base">
                            Fechar
                        </button>
                    </div>
                </div>
            </div>

            <main class="flex flex-col flex-grow min-h-0">
                <div id="chat-area" class="flex-grow p-3 rounded-xl overflow-y-auto mb-2">
                    <div class="text-center text-gray-500 italic py-8">
                        Crie seu personagem para come√ßar a aventura...
                    </div>
                </div>
            </main>

            <!-- √ÅREA DE INPUT CORRIGIDA -->
            <section class="input-section">
                <input type="text" id="user-input" placeholder="Digite sua a√ß√£o..." class="flex-grow p-3 rounded-xl bg-gray-800 text-white border border-gray-600" disabled>
                <button id="send-button" class="font-bold rounded-xl" disabled>
                    Enviar
                </button>
            </section>
        </div>
    </div>

    <script>
        // =============================================
        // CONFIGURA√á√ÉO DA API GEMINI
        // =============================================

        const GEMINI_API_KEY = 'AIzaSyCzzUkdam5YmkiaDgdKsd1ufCZI26SRs2I';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';

        async function generateWithGemini(prompt) {
            try {
                console.log('Enviando prompt para Gemini:', prompt.substring(0, 100) + '...');
                
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.8,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 1024,
                        }
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Erro na resposta da API:', response.status, errorText);
                    throw new Error(`Erro na API: ${response.status}`);
                }

                const data = await response.json();
                console.log('Resposta recebida do Gemini');
                
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                    throw new Error('Resposta da API em formato inesperado');
                }
                
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error('Erro ao chamar Gemini API:', error);
                return getFallbackResponse(prompt);
            }
        }

        function getFallbackResponse(prompt) {
            const lowerPrompt = prompt.toLowerCase();
            
            // Respostas mais elaboradas para o fallback
            const explorations = [
                "Voc√™ adentra uma floresta densa, onde os raios de sol mal conseguem penetrar a copa das √°rvores. No centro de uma clareira, voc√™ avista uma antiga constru√ß√£o de pedra coberta por musgo. O ar est√° carregado de uma energia ancestral. O que voc√™ faz?",
                "Enquanto explora as ru√≠nas, voc√™ encontra um di√°rio antigo. As p√°ginas amareladas cont√™m relatos de um mago que estudava artefatos perdidos. Uma entrada em particular chama sua aten√ß√£o: 'O cristal luna responde apenas ao cora√ß√£o puro...'",
                "Seguindo o rio, voc√™ chega a uma vila pitoresca. Os moradores parecem agitados - algo sobre 'sombras noturnas' e 'desaparecimentos'. Uma anci√£ se aproxima com um olhar s√©rio.",
                "Nas montanhas, voc√™ descobre uma caverna com inscri√ß√µes antigas. Elas parecem contar a hist√≥ria de um her√≥i que selou uma entidade maligna h√° s√©culos. Uma das inscri√ß√µes est√° incompleta..."
            ];
            
            const combats = [
                "O inimigo avan√ßa com f√∫ria! Seus olhos brilham com uma luz sinistra enquanto desfere golpes precisos. Voc√™ precisa pensar r√°pido para sobreviver a este confronto!",
                "Em um movimento √°gil, voc√™ desvia do ataque e encontra uma abertura. Seu golpe atinge o alvo, fazendo o inimigo recuar com um grunhido de dor.",
                "A batalha est√° equilibrada. Ambos trocam golpes, testando as defesas um do outro. O som do metal contra metal ecoa pelo ambiente.",
                "Voc√™ sente a adrenalina correr em suas veias. Cada movimento √© crucial, cada decis√£o pode significar a diferen√ßa entre vit√≥ria e derrota."
            ];
            
            const dialogues = [
                "O personagem olha profundamente em seus olhos antes de falar. 'H√° muito tempo eu esperava por algu√©m como voc√™', diz ele em voz baixa. 'O mundo est√° mudando, e poucos percebem o perigo que se aproxima.'",
                "Ela ri suavemente. 'Voc√™ √© mais perspicaz do que aparenta. Talvez tenha chegado a hora de compartilhar alguns segredos...'",
                "O velho s√°bio acena lentamente. 'Sua pergunta toca em assuntos que muitos temem discutir. Mas para voc√™, a verdade ser√° revelada.'",
                "Eles trocam olhares hesitantes antes de um deles falar. 'N√£o dever√≠amos estar falando sobre isso aqui. Encontre-me no bosque ao p√¥r do sol, e lhe direi o que sei.'"
            ];
            
            if (lowerPrompt.includes('explorar') || lowerPrompt.includes('investigar') || lowerPrompt.includes('floresta') || lowerPrompt.includes('ru√≠na')) {
                return explorations[Math.floor(Math.random() * explorations.length)];
            }
            
            if (lowerPrompt.includes('lutar') || lowerPrompt.includes('atacar') || lowerPrompt.includes('combate') || lowerPrompt.includes('batalha')) {
                return combats[Math.floor(Math.random() * combats.length)];
            }
            
            if (lowerPrompt.includes('conversar') || lowerPrompt.includes('falar') || lowerPrompt.includes('perguntar') || lowerPrompt.includes('dialog')) {
                return dialogues[Math.floor(Math.random() * dialogues.length)];
            }
            
            // Resposta gen√©rica criativa
            const creativeResponses = [
                "Sua a√ß√£o desencadeia consequ√™ncias inesperadas. O mundo ao seu redor parece responder √† sua presen√ßa, como se cada escolha sua ecoasse atrav√©s do tecido da realidade.",
                "H√° uma mudan√ßa sutil no ar - uma sensa√ß√£o de que algo importante est√° prestes a acontecer. Suas decis√µes moldam n√£o apenas seu destino, mas o do mundo inteiro.",
                "No sil√™ncio que se segue, voc√™ percebe que est√° em uma encruzilhada. Cada caminho √† frente leva a destinos diferentes, cada um com seus pr√≥prios perigos e recompensas.",
                "Uma sabedoria antiga parece fluir atrav√©s de voc√™. Talvez sejam os ecos dos que vieram antes, guiando seus passos em dire√ß√£o ao seu verdadeiro prop√≥sito."
            ];
            
            return creativeResponses[Math.floor(Math.random() * creativeResponses.length)];
        }

        // =============================================
        // SISTEMA DE M√öSICA SIMPLIFICADO
        // =============================================

        let isAudioPlaying = false;
        let currentMusicType = 'none';
        let audioElement = null;
        let musicVolume = 0.5;

        function toggleMusic() {
            if (currentMusicType === 'none') {
                // Sem m√∫sica
                if (audioElement) {
                    audioElement.pause();
                    audioElement = null;
                }
                isAudioPlaying = false;
                document.getElementById('audio-toggle-button').textContent = 'üéµ M√∫sica';
            } else {
                if (isAudioPlaying) {
                    // Parar m√∫sica
                    if (audioElement) {
                        audioElement.pause();
                    }
                    isAudioPlaying = false;
                    document.getElementById('audio-toggle-button').textContent = 'üéµ M√∫sica';
                } else {
                    // Iniciar m√∫sica ambiente suave
                    audioElement = new Audio('https://assets.mixkit.co/music/preview/mixkit-tech-house-vibes-130.mp3');
                    audioElement.loop = true;
                    audioElement.volume = musicVolume;
                    audioElement.play().catch(e => console.log('Autoplay bloqueado:', e));
                    isAudioPlaying = true;
                    document.getElementById('audio-toggle-button').textContent = 'üîá M√∫sica';
                }
            }
        }

        function setMusicVolume(volume) {
            musicVolume = volume / 100;
            if (audioElement) {
                audioElement.volume = musicVolume;
            }
            document.getElementById('volume-value').textContent = volume + '%';
        }

        // =============================================
        // SISTEMA DE ATRIBUTOS POR CLASSE
        // =============================================

        const classAttributes = {
            'Guerreiro': { strength: 16, dexterity: 12, constitution: 15, intelligence: 8, wisdom: 10, charisma: 9 },
            'Mago': { strength: 8, dexterity: 10, constitution: 9, intelligence: 16, wisdom: 14, charisma: 11 },
            'Arqueiro': { strength: 12, dexterity: 16, constitution: 13, intelligence: 10, wisdom: 12, charisma: 10 },
            'Ladino': { strength: 11, dexterity: 16, constitution: 12, intelligence: 13, wisdom: 11, charisma: 12 },
            'Paladino': { strength: 15, dexterity: 10, constitution: 14, intelligence: 9, wisdom: 13, charisma: 14 },
            'Bardo': { strength: 10, dexterity: 14, constitution: 11, intelligence: 12, wisdom: 11, charisma: 16 },
            'Druida': { strength: 11, dexterity: 12, constitution: 13, intelligence: 13, wisdom: 16, charisma: 10 },
            'Necromante': { strength: 9, dexterity: 11, constitution: 12, intelligence: 16, wisdom: 14, charisma: 8 }
        };

        const classVitality = {
            'Guerreiro': { hp: 120, mp: 30, stamina: 100 },
            'Mago': { hp: 70, mp: 100, stamina: 60 },
            'Arqueiro': { hp: 90, mp: 50, stamina: 90 },
            'Ladino': { hp: 85, mp: 40, stamina: 110 },
            'Paladino': { hp: 110, mp: 60, stamina: 85 },
            'Bardo': { hp: 80, mp: 70, stamina: 90 },
            'Druida': { hp: 95, mp: 80, stamina: 75 },
            'Necromante': { hp: 75, mp: 90, stamina: 65 }
        };

        function applyClassAttributes(className) {
            if (classAttributes[className]) {
                // Salva os atributos base da classe
                const classBaseAttributes = { ...classAttributes[className] };
                
                // Mant√©m os pontos de atributo para distribui√ß√£o personalizada
                // mas aplica os valores base como m√≠nimo
                Object.keys(attributes).forEach(attr => {
                    if (attributes[attr] < classBaseAttributes[attr]) {
                        attributes[attr] = classBaseAttributes[attr];
                    }
                });
                
                updateAttributeDisplay();
            }
        }

        function getClassVitality(className) {
            return classVitality[className] || { hp: 100, mp: 50, stamina: 100 };
        }

        // =============================================
        // SISTEMA DO JOGO PRINCIPAL
        // =============================================

        // Estado do jogo
        let localCharacterProfile = null;
        let chatMessages = [];
        let currentEnemy = null;
        let isInCombat = false;
        let selectedClass = null;
        let skillPoints = 0;
        let relationships = {};
        let gameMode = 'singleplayer';
        let storyMode = 'sandbox';
        let attributePoints = 15;
        let attributes = {
            strength: 10,
            dexterity: 10,
            constitution: 10,
            intelligence: 10,
            wisdom: 10,
            charisma: 10
        };

        // Elementos DOM
        const chatArea = document.getElementById('chat-area');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const characterSetupModal = document.getElementById('character-setup');
        const saveCharacterButton = document.getElementById('save-character-button');
        const charNameInput = document.getElementById('char-name-input');
        const charAgeInput = document.getElementById('char-age-input');
        const charSexInput = document.getElementById('char-sex-input');
        const audioToggleButton = document.getElementById('audio-toggle-button');
        const resetGameButton = document.getElementById('reset-game-button');
        const saveGameButton = document.getElementById('save-game-button');
        const musicModal = document.getElementById('music-modal');
        const closeMusicButton = document.getElementById('close-music-button');
        const volumeSlider = document.getElementById('volume-slider');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');

        // Sistema de mensagens
        function addMessage(text, sender, type = 'normal') {
            const messageDiv = document.createElement('div');
            let messageClass = `message-box ${sender === 'user' ? 'user-message' : 'ai-message'}`;
            
            if (type === 'combat') messageClass += ' combat-message';
            else if (type === 'level-up') messageClass += ' level-up-message';
            else if (type === 'spell') messageClass += ' spell-message';
            
            messageDiv.className = messageClass;
            messageDiv.innerHTML = `
                <div class="font-bold text-sm mb-1">${sender === 'user' ? 'Voc√™' : 'Mestre IA'}</div>
                <div class="whitespace-pre-wrap text-sm">${text}</div>
            `;
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
            
            chatMessages.push({ text, sender, type });
        }

        // Sistema de IA com Gemini
        async function generateAIResponse(userMessage, characterContext) {
            const prompt = `
Voc√™ √© um Mestre de RPG experiente e criativo. Crie uma narrativa envolvente baseada na a√ß√£o do jogador.

CONTEXTO:
- Personagem: ${characterContext.name}, ${characterContext.role}, N√≠vel ${characterContext.level}
- Modo de Hist√≥ria: ${storyMode}
- Mundo: ${getCurrentWorldContext()}
- Atributos: For√ßa ${attributes.strength}, Destreza ${attributes.dexterity}, Intelig√™ncia ${attributes.intelligence}

A√á√ÉO DO JOGADOR: "${userMessage}"

DIRETRIZES:
- Seja descritivo e imersivo
- Avance a narrativa de forma org√¢nica
- Inclua elementos de fantasia e aventura
- Mantenha coer√™ncia com o contexto
- Ofere√ßa escolhas interessantes quando apropriado
- Limite a resposta a 2-3 par√°grafos

RESPONDA APENAS COMO MESTRE DE RPG:`;

            // Adiciona indicador de carregamento
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message-box ai-message';
            loadingDiv.innerHTML = `
                <div class="font-bold text-sm mb-1">Mestre IA</div>
                <div class="flex items-center">
                    <span>Pensando...</span>
                    <div class="loading-indicator"></div>
                </div>
            `;
            chatArea.appendChild(loadingDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
            
            try {
                const response = await generateWithGemini(prompt);
                
                // Remove o indicador de carregamento
                chatArea.removeChild(loadingDiv);
                
                addMessage(response, 'ai');
                
                // Chance de eventos aleat√≥rios ap√≥s resposta da IA
                if (Math.random() < 0.25) {
                    triggerRandomEvent();
                }
                
            } catch (error) {
                console.error('Erro na IA:', error);
                
                // Remove o indicador de carregamento
                if (chatArea.contains(loadingDiv)) {
                    chatArea.removeChild(loadingDiv);
                }
                
                const fallback = getFallbackResponse(userMessage);
                addMessage(fallback, 'ai');
            }
        }

        function getCurrentWorldContext() {
            if (storyMode === 'sandbox') {
                return "Mundo aberto de fantasia com reinos diversos, criaturas m√°gicas e locais antigos para explorar";
            } else {
                return "Narrativa √©pica com profecia antiga, fac√ß√µes em conflito e um her√≥i destinado a grandes feitos";
            }
        }

        function triggerRandomEvent() {
            const events = [
                () => {
                    const enemy = { 
                        name: "Goblin Saqueador", 
                        level: localCharacterProfile.level, 
                        reason: "procurando por tesouros" 
                    };
                    addMessage(`‚ö†Ô∏è **${enemy.name}** aparece! Ele est√° ${enemy.reason}. Prepare-se para o combate!`, 'ai', 'combat');
                    startCombat(enemy);
                },
                () => {
                    const xpGain = 15 + Math.floor(Math.random() * 20);
                    gainXP(xpGain);
                    addMessage(`‚ú® Voc√™ ganhou ${xpGain} de XP por sua a√ß√£o heroica!`, 'ai');
                },
                () => {
                    const npcs = [
                        { name: "Eldrin, o S√°bio", description: "Um mago anci√£o com conhecimento arcano" },
                        { name: "Lyra, a Ca√ßadora", description: "Uma rastreadora habilidosa da floresta" },
                        { name: "Thorn, o Ferreiro", description: "Um artes√£o que forja armas lend√°rias" }
                    ];
                    const npc = npcs[Math.floor(Math.random() * npcs.length)];
                    
                    if (!relationships[npc.name]) {
                        relationships[npc.name] = { level: 15, description: npc.description };
                        updateRelationshipsUI();
                        addMessage(`üíù Voc√™ conheceu **${npc.name}**! ${npc.description}`, 'ai');
                    }
                },
                () => {
                    const items = ["Po√ß√£o de Cura", "Elixir de Mana", "Dardo Envenenado", "Pergaminho Antigo"];
                    const item = items[Math.floor(Math.random() * items.length)];
                    localCharacterProfile.inventory.push(item);
                    updateInventoryUI();
                    addMessage(`üéÅ Voc√™ encontrou: **${item}**! Foi adicionado ao seu invent√°rio.`, 'ai');
                }
            ];
            
            events[Math.floor(Math.random() * events.length)]();
        }

        // Enviar mensagem
        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text || !localCharacterProfile) return;
            
            addMessage(text, 'user');
            userInput.value = '';
            userInput.disabled = true;
            sendButton.disabled = true;
            
            // Gerar resposta da IA
            await generateAIResponse(text, localCharacterProfile);
            
            userInput.disabled = false;
            sendButton.disabled = false;
            userInput.focus();
        }

        // Sistema de XP e Level Up
        function gainXP(amount) {
            if (!localCharacterProfile) return;
            
            localCharacterProfile.xp += amount;
            const xpNeeded = localCharacterProfile.level * 100;
            
            document.getElementById('sidebar-char-xp').textContent = `${localCharacterProfile.xp}/${xpNeeded}`;
            document.getElementById('xp-bar').style.width = `${Math.min(100, (localCharacterProfile.xp / xpNeeded) * 100)}%`;
            
            if (localCharacterProfile.xp >= xpNeeded) {
                levelUp();
            }
        }
        
        function levelUp() {
            localCharacterProfile.level++;
            localCharacterProfile.xp = 0;
            skillPoints += 2;
            
            // Aumentar stats baseados na classe
            const vitality = getClassVitality(localCharacterProfile.role);
            localCharacterProfile.maxHP = vitality.hp + (localCharacterProfile.level * 10);
            localCharacterProfile.currentHP = localCharacterProfile.maxHP;
            localCharacterProfile.maxMP = vitality.mp + (localCharacterProfile.level * 5);
            localCharacterProfile.currentMP = localCharacterProfile.maxMP;
            localCharacterProfile.maxStamina = vitality.stamina + (localCharacterProfile.level * 8);
            localCharacterProfile.currentStamina = localCharacterProfile.maxStamina;
            
            document.getElementById('sidebar-char-level').textContent = localCharacterProfile.level;
            document.getElementById('sidebar-char-xp').textContent = `0/${localCharacterProfile.level * 100}`;
            document.getElementById('xp-bar').style.width = '0%';
            updateHealthBars();
            
            addMessage(`üéâ **LEVEL UP!** Voc√™ alcan√ßou o n√≠vel ${localCharacterProfile.level}! Ganhou 2 pontos de habilidade.`, 'ai', 'level-up');
        }

        // Atualizar barras de sa√∫de
        function updateHealthBars() {
            if (!localCharacterProfile) return;
            
            const hpPercent = (localCharacterProfile.currentHP / localCharacterProfile.maxHP) * 100;
            const mpPercent = (localCharacterProfile.currentMP / localCharacterProfile.maxMP) * 100;
            const staminaPercent = (localCharacterProfile.currentStamina / localCharacterProfile.maxStamina) * 100;
            
            document.getElementById('hp-bar').style.width = `${Math.max(0, hpPercent)}%`;
            document.getElementById('mp-bar').style.width = `${Math.max(0, mpPercent)}%`;
            document.getElementById('stamina-bar').style.width = `${Math.max(0, staminaPercent)}%`;
            
            document.getElementById('hp-value').textContent = `${Math.max(0, localCharacterProfile.currentHP)}/${localCharacterProfile.maxHP}`;
            document.getElementById('mp-value').textContent = `${Math.max(0, localCharacterProfile.currentMP)}/${localCharacterProfile.maxMP}`;
            document.getElementById('stamina-value').textContent = `${Math.max(0, localCharacterProfile.currentStamina)}/${localCharacterProfile.maxStamina}`;
        }

        // Atualizar invent√°rio na UI
        function updateInventoryUI() {
            const inventoryList = document.getElementById('inventory-list');
            inventoryList.innerHTML = '';
            
            if (localCharacterProfile.inventory.length === 0) {
                inventoryList.innerHTML = '<li class="text-gray-400 italic">Invent√°rio vazio</li>';
            } else {
                localCharacterProfile.inventory.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    li.className = 'text-white';
                    inventoryList.appendChild(li);
                });
            }
        }

        // Atualizar relacionamentos na UI
        function updateRelationshipsUI() {
            const relationshipsList = document.getElementById('relationships-list');
            
            if (Object.keys(relationships).length === 0) {
                relationshipsList.innerHTML = '<p class="text-gray-400 italic text-sm">Ainda n√£o conheceu ningu√©m</p>';
            } else {
                relationshipsList.innerHTML = '';
                
                Object.entries(relationships).forEach(([name, data]) => {
                    const relationshipItem = document.createElement('div');
                    relationshipItem.className = 'text-sm mb-1';
                    relationshipItem.innerHTML = `
                        <span class="font-bold">${name}</span>: ${data.level}/100
                    `;
                    relationshipsList.appendChild(relationshipItem);
                });
            }
        }

        // Atualizar atributos na UI
        function updateAttributeDisplay() {
            // Atualizar cria√ß√£o de personagem
            document.getElementById('create-strength').textContent = attributes.strength;
            document.getElementById('create-dexterity').textContent = attributes.dexterity;
            document.getElementById('create-constitution').textContent = attributes.constitution;
            document.getElementById('create-intelligence').textContent = attributes.intelligence;
            document.getElementById('create-wisdom').textContent = attributes.wisdom;
            document.getElementById('create-charisma').textContent = attributes.charisma;
            document.getElementById('attribute-points').textContent = attributePoints;

            // Atualizar sidebar
            document.getElementById('attr-strength').textContent = attributes.strength;
            document.getElementById('attr-dexterity').textContent = attributes.dexterity;
            document.getElementById('attr-constitution').textContent = attributes.constitution;
            document.getElementById('attr-intelligence').textContent = attributes.intelligence;
            document.getElementById('attr-wisdom').textContent = attributes.wisdom;
            document.getElementById('attr-charisma').textContent = attributes.charisma;
        }

        // Atualizar habilidades na UI
        function updateSkillsList() {
            const skillsList = document.getElementById('skills-list');
            skillsList.innerHTML = '';
            
            if (localCharacterProfile.skills.length === 0) {
                skillsList.innerHTML = '<li class="text-gray-400 italic">Nenhuma habilidade aprendida</li>';
            } else {
                localCharacterProfile.skills.forEach(skill => {
                    const li = document.createElement('li');
                    li.textContent = skill;
                    li.className = 'text-white';
                    skillsList.appendChild(li);
                });
            }
        }

        // Criar personagem
        function saveCharacterProfile() {
            const name = charNameInput.value.trim();
            const age = charAgeInput.value;
            const sex = charSexInput.value;
            const role = selectedClass;
            
            if (!name || !age || !sex || !role) {
                alert('Por favor, preencha todos os campos!');
                return;
            }
            
            // Aplicar atributos da classe
            applyClassAttributes(role);
            const vitality = getClassVitality(role);
            
            localCharacterProfile = {
                name: name,
                age: age,
                sex: sex,
                role: role,
                level: 1,
                xp: 0,
                maxHP: vitality.hp,
                currentHP: vitality.hp,
                maxMP: vitality.mp,
                currentMP: vitality.mp,
                maxStamina: vitality.stamina,
                currentStamina: vitality.stamina,
                inventory: ["Po√ß√£o de Cura"],
                skills: ["Ataque B√°sico"],
                attributes: {...attributes}
            };
            
            skillPoints = 0;
            
            // Fechar modal e atualizar UI
            characterSetupModal.style.display = 'none';
            document.getElementById('character-name-display').textContent = `${name} (${role})`;
            document.getElementById('sidebar-char-name').textContent = name;
            document.getElementById('sidebar-char-role').textContent = role;
            document.getElementById('sidebar-char-level').textContent = '1';
            document.getElementById('sidebar-char-xp').textContent = '0/100';
            
            updateAttributeDisplay();
            updateHealthBars();
            updateSkillsList();
            updateInventoryUI();
            
            // Habilitar chat
            userInput.disabled = false;
            userInput.placeholder = `Digite sua a√ß√£o (Modo: ${storyMode === 'sandbox' ? 'Sandbox Livre' : 'Narrativa Guiada'})...`;
            sendButton.disabled = false;
            
            // Limpar chat e iniciar hist√≥ria
            chatArea.innerHTML = '';
            startInitialStory();
            
            // Iniciar m√∫sica se n√£o for "none"
            if (currentMusicType !== 'none') {
                toggleMusic();
            }
        }

        function startInitialStory() {
            let initialMessage;
            
            if (storyMode === 'sandbox') {
                initialMessage = `üåç **MUNDO ABERTO - ${localCharacterProfile.name} O ${localCharacterProfile.role}**

Voc√™ est√° no vasto mundo de Eldoria, onde cada caminho leva a novas descobertas. Como ${localCharacterProfile.role}, suas habilidades √∫nicas moldar√£o seu destino.

**SEU IN√çCIO:**
‚Ä¢ Os ventos sussurram segredos antigos
‚Ä¢ Estradas levam a cidades, florestas e montanhas
‚Ä¢ O futuro √© uma p√°gina em branco esperando sua hist√≥ria

O que voc√™ faz primeiro em sua jornada?`;
            } else {
                initialMessage = `üìú **A PROFECIA DESPERTA - ${localCharacterProfile.name} O ${localCharacterProfile.role}**

H√° gera√ß√µes, os or√°culos previram: "Quando as estrelas se alinharem, um her√≥i surgir√° das sombras". 

Hoje, sinais estranhos aparecem no c√©u. Pessoas falam de sonhos compartilhados, de um chamado urgente. E voc√™, ${localCharacterProfile.name}, sente algo diferente - um prop√≥sito maior esperando para ser descoberto.

**SEU CHAMADO COME√áA AGORA.**

O que voc√™ faz?`;
            }
            
            addMessage(initialMessage, 'ai');
        }

        // Sistema de Combate
        function startCombat(enemy) {
            isInCombat = true;
            currentEnemy = enemy;
            
            document.getElementById('combat-ui').classList.remove('hidden');
            document.getElementById('enemy-name').textContent = enemy.name;
            document.getElementById('enemy-level').textContent = `N√≠vel: ${enemy.level}`;
        }

        function playerAttack() {
            if (!isInCombat || !currentEnemy) return;
            
            const baseDamage = 8 + Math.floor(attributes.strength / 2) + Math.floor(attributes.dexterity / 4);
            const damage = baseDamage + Math.floor(Math.random() * 8);
            
            addMessage(`üí• Voc√™ ataca ${currentEnemy.name} causando ${damage} de dano!`, 'ai', 'combat');
            
            // Usar stamina
            useStamina(5);
            
            setTimeout(() => {
                // Inimigo contra-ataca
                const enemyDamage = 5 + Math.floor(Math.random() * 8);
                takeDamage(enemyDamage);
                
                addMessage(`üëπ ${currentEnemy.name} contra-ataca causando ${enemyDamage} de dano!`, 'ai', 'combat');
                
                // Verificar se o jogador foi derrotado
                if (localCharacterProfile.currentHP <= 0) {
                    addMessage(`üíÄ Voc√™ foi derrotado por ${currentEnemy.name}! A aventura termina aqui...`, 'ai', 'combat');
                    endCombat(false);
                }
            }, 1000);
        }

        function takeDamage(amount) {
            if (!localCharacterProfile) return;
            
            localCharacterProfile.currentHP = Math.max(0, localCharacterProfile.currentHP - amount);
            updateHealthBars();
        }

        function useStamina(amount) {
            if (!localCharacterProfile) return;
            
            localCharacterProfile.currentStamina = Math.max(0, localCharacterProfile.currentStamina - amount);
            updateHealthBars();
        }

        function endCombat(victory) {
            isInCombat = false;
            currentEnemy = null;
            
            document.getElementById('combat-ui').classList.add('hidden');
            document.getElementById('skills-section').classList.add('hidden');
            
            if (victory) {
                const xpGained = 20 + Math.floor(Math.random() * 30);
                gainXP(xpGained);
                addMessage(`üéâ **VIT√ìRIA!** Voc√™ ganhou ${xpGained} de XP!`, 'ai', 'level-up');
            }
        }

        // Sistema de Salvamento
        function saveGame() {
            if (!localCharacterProfile) {
                alert('Nenhum jogo em andamento para salvar!');
                return;
            }

            const gameData = {
                character: localCharacterProfile,
                chatMessages: chatMessages,
                relationships: relationships,
                skillPoints: skillPoints,
                storyMode: storyMode,
                attributes: attributes,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('rpgTextualSave', JSON.stringify(gameData));
            addMessage('üíæ **Jogo salvo com sucesso!** Voc√™ pode continuar de onde parou posteriormente.', 'ai');
        }

        function loadGame() {
            const savedData = localStorage.getItem('rpgTextualSave');
            
            if (!savedData) {
                alert('Nenhum jogo salvo encontrado!');
                return;
            }

            try {
                const gameData = JSON.parse(savedData);
                
                // Restaurar dados do jogo
                localCharacterProfile = gameData.character;
                chatMessages = gameData.chatMessages || [];
                relationships = gameData.relationships || {};
                skillPoints = gameData.skillPoints || 0;
                storyMode = gameData.storyMode || 'sandbox';
                attributes = gameData.attributes || {
                    strength: 10,
                    dexterity: 10,
                    constitution: 10,
                    intelligence: 10,
                    wisdom: 10,
                    charisma: 10
                };

                // Atualizar UI
                updateUIFromSave();
                
                // Limpar chat e recarregar mensagens
                chatArea.innerHTML = '';
                chatMessages.forEach(msg => {
                    addMessage(msg.text, msg.sender, msg.type);
                });

                addMessage('üîÑ **Jogo carregado!** Bem-vindo de volta, ' + localCharacterProfile.name + '!', 'ai');
                
            } catch (error) {
                console.error('Erro ao carregar jogo:', error);
                alert('Erro ao carregar o jogo salvo!');
            }
        }

        function updateUIFromSave() {
            if (!localCharacterProfile) return;

            document.getElementById('character-name-display').textContent = `${localCharacterProfile.name} (${localCharacterProfile.role})`;
            document.getElementById('sidebar-char-name').textContent = localCharacterProfile.name;
            document.getElementById('sidebar-char-role').textContent = localCharacterProfile.role;
            document.getElementById('sidebar-char-level').textContent = localCharacterProfile.level;
            document.getElementById('sidebar-char-xp').textContent = `${localCharacterProfile.xp}/${localCharacterProfile.level * 100}`;
            
            // Atualizar atributos
            updateAttributeDisplay();
            
            // Atualizar barras de vida/mana/stamina
            updateHealthBars();
            
            // Atualizar habilidades
            updateSkillsList();
            
            // Atualizar relacionamentos
            updateRelationshipsUI();
            
            // Atualizar invent√°rio
            updateInventoryUI();
            
            // Habilitar chat
            userInput.disabled = false;
            userInput.placeholder = `Digite sua a√ß√£o (Modo: ${storyMode === 'sandbox' ? 'Sandbox Livre' : 'Narrativa Guiada'})...`;
            sendButton.disabled = false;
            
            // Fechar modal de cria√ß√£o se estiver aberto
            characterSetupModal.style.display = 'none';
        }

        function resetGame() {
            if (confirm('Tem certeza que deseja iniciar um novo jogo? Todo o progresso atual ser√° perdido!')) {
                // Limpar dados
                localCharacterProfile = null;
                chatMessages = [];
                relationships = {};
                skillPoints = 0;
                attributes = {
                    strength: 10,
                    dexterity: 10,
                    constitution: 10,
                    intelligence: 10,
                    wisdom: 10,
                    charisma: 10
                };
                attributePoints = 15;

                // Parar m√∫sica
                if (audioElement) {
                    audioElement.pause();
                    audioElement = null;
                }
                isAudioPlaying = false;
                document.getElementById('audio-toggle-button').textContent = 'üéµ M√∫sica';

                // Limpar UI
                chatArea.innerHTML = '<div class="text-center text-gray-500 italic py-8">Crie seu personagem para come√ßar a aventura...</div>';
                document.getElementById('character-name-display').textContent = '...';
                document.getElementById('sidebar-char-name').textContent = '-';
                document.getElementById('sidebar-char-role').textContent = '-';
                document.getElementById('sidebar-char-level').textContent = '1';
                document.getElementById('sidebar-char-xp').textContent = '0/100';
                
                // Desabilitar chat
                userInput.disabled = true;
                sendButton.disabled = true;
                
                // Abrir modal de cria√ß√£o
                characterSetupModal.style.display = 'flex';
                
                // Resetar formul√°rio de cria√ß√£o
                charNameInput.value = '';
                charAgeInput.value = '';
                charSexInput.value = '';
                document.querySelectorAll('.class-card').forEach(card => {
                    card.classList.remove('selected');
                });
                selectedClass = null;
                updateAttributeDisplay();
            }
        }

        // =============================================
        // INICIALIZA√á√ÉO E EVENT LISTENERS
        // =============================================

        // Event Listeners para sele√ß√£o de classe
        document.querySelectorAll('.class-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.class-card').forEach(c => {
                    c.classList.remove('selected');
                });
                card.classList.add('selected');
                selectedClass = card.getAttribute('data-class');
            });
        });

        // Event Listeners para atributos
        document.querySelectorAll('.attribute-plus').forEach(button => {
            button.addEventListener('click', (e) => {
                if (attributePoints <= 0) return;
                
                const attribute = e.target.getAttribute('data-attribute');
                attributes[attribute]++;
                attributePoints--;
                updateAttributeDisplay();
            });
        });

        document.querySelectorAll('.attribute-minus').forEach(button => {
            button.addEventListener('click', (e) => {
                const attribute = e.target.getAttribute('data-attribute');
                if (attributes[attribute] <= 8) return;
                
                attributes[attribute]--;
                attributePoints++;
                updateAttributeDisplay();
            });
        });

        // Event Listeners para modo de jogo
        document.getElementById('singleplayer-btn').addEventListener('click', () => setGameMode('singleplayer'));
        document.getElementById('multiplayer-btn').addEventListener('click', () => setGameMode('multiplayer'));
        document.getElementById('setup-singleplayer-btn').addEventListener('click', () => setGameMode('singleplayer'));
        document.getElementById('setup-multiplayer-btn').addEventListener('click', () => setGameMode('multiplayer'));

        function setGameMode(mode) {
            gameMode = mode;
            
            // Atualizar bot√µes da sidebar
            if (mode === 'singleplayer') {
                document.getElementById('singleplayer-btn').classList.add('active');
                document.getElementById('multiplayer-btn').classList.remove('active');
                document.getElementById('multiplayer-info').innerHTML = '<p class="text-gray-400 italic">Modo singleplayer ativo</p>';
            } else {
                document.getElementById('singleplayer-btn').classList.remove('active');
                document.getElementById('multiplayer-btn').classList.add('active');
                document.getElementById('multiplayer-info').innerHTML = `
                    <p class="text-yellow-400">Modo multiplayer</p>
                    <p class="text-xs text-gray-400">Firebase n√£o configurado</p>
                `;
            }

            // Atualizar bot√µes do setup
            if (mode === 'singleplayer') {
                document.getElementById('setup-singleplayer-btn').classList.add('active');
                document.getElementById('setup-multiplayer-btn').classList.remove('active');
            } else {
                document.getElementById('setup-singleplayer-btn').classList.remove('active');
                document.getElementById('setup-multiplayer-btn').classList.add('active');
            }
        }

        // Event Listeners para modo de hist√≥ria
        document.querySelectorAll('.story-mode-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.story-mode-card').forEach(c => {
                    c.classList.remove('selected');
                });
                card.classList.add('selected');
                storyMode = card.getAttribute('data-mode');
            });
        });

        // Event Listeners para m√∫sica
        document.querySelectorAll('.music-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.music-option').forEach(o => {
                    o.classList.remove('selected');
                });
                option.classList.add('selected');
                currentMusicType = option.getAttribute('data-music');
                
                // Se a m√∫sica estiver tocando, reiniciar com o novo tipo
                if (isAudioPlaying) {
                    toggleMusic();
                    toggleMusic();
                }
            });
        });

        // Event Listeners principais
        saveCharacterButton.addEventListener('click', saveCharacterProfile);
        sendButton.addEventListener('click', sendMessage);
        sidebarToggle.addEventListener('click', () => sidebar.classList.toggle('open'));
        audioToggleButton.addEventListener('click', toggleMusic);
        resetGameButton.addEventListener('click', resetGame);
        saveGameButton.addEventListener('click', saveGame);
        closeMusicButton.addEventListener('click', () => musicModal.classList.add('hidden'));
        document.getElementById('audio-toggle-button').addEventListener('click', () => musicModal.classList.remove('hidden'));
        volumeSlider.addEventListener('input', (e) => setMusicVolume(e.target.value));

        // Event Listener para Enter no input
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Event Listeners de combate
        document.getElementById('attack-btn').addEventListener('click', playerAttack);
        document.getElementById('skill-btn').addEventListener('click', () => {
            document.getElementById('skills-section').classList.toggle('hidden');
        });
        document.getElementById('flee-btn').addEventListener('click', () => {
            if (isInCombat) {
                addMessage('üèÉ Voc√™ fugiu do combate!', 'ai', 'combat');
                endCombat(false);
            }
        });

        // Verificar se h√° jogo salvo ao carregar a p√°gina
        window.addEventListener('load', () => {
            const savedData = localStorage.getItem('rpgTextualSave');
            if (savedData) {
                if (confirm('Foi encontrado um jogo salvo. Deseja continuar de onde parou?')) {
                    loadGame();
                } else {
                    characterSetupModal.style.display = 'flex';
                }
            } else {
                characterSetupModal.style.display = 'flex';
            }
            updateAttributeDisplay();
        });

        console.log(`
üéÆ RPG TEXTUAL - SISTEMA COMPLETO ATUALIZADO

‚úÖ API Gemini 2.0 Flash integrada e funcionando
‚úÖ Sua chave API configurada: ${GEMINI_API_KEY.substring(0, 10)}...
‚úÖ Sistema de IA gerando hist√≥rias din√¢micas
‚úÖ Atributos balanceados por classe
‚úÖ Sistema de m√∫sica simplificado
‚úÖ Interface totalmente funcional

PRONTO PARA JOGAR! üéâ

Instru√ß√µes:
1. Crie seu personagem
2. Digite a√ß√µes no chat
3. A IA criar√° hist√≥rias baseadas nas suas escolhas
4. Explore, lute e viva aventuras √©picas!
        `);
    </script>
</body>
</html>
