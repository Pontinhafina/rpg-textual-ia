<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG Textual: Mestre IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400..900&family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&display=swap');
        
        :root {
            --primary-dark: #1a1f2e;
            --primary-medium: #2a3245;
            --primary-light: #3a445c;
            --accent-gold: #d4af37;
            --accent-red: #c41e3a;
            --accent-blue: #1e90ff;
            --text-light: #f5f5f5;
            --text-dim: #b8b8b8;
        }
        
        body {
            font-family: 'Merriweather', serif;
            background-color: var(--primary-dark);
            color: var(--text-light);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(42, 50, 69, 0.5) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(42, 50, 69, 0.5) 0%, transparent 20%);
        }

        #main-header {
            background: linear-gradient(145deg, var(--primary-medium) 0%, var(--primary-dark) 100%);
            border: 2px solid var(--accent-gold);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5), inset 0 0 10px rgba(212, 175, 55, 0.2);
        }
        
        #main-header h1 {
            font-family: 'Cinzel', serif; 
            font-size: 1.5rem; 
            text-shadow: 0 0 8px var(--accent-gold), 0 0 15px rgba(212, 175, 55, 0.6); 
            color: var(--accent-gold);
        }
        
        @media (min-width: 768px) {
            #main-header h1 {
                font-size: 2.5rem;
            }
        }
        
        #character-name-display { 
            color: var(--accent-gold); 
            text-shadow: 0 0 3px rgba(212, 175, 55, 0.3); 
            font-size: 0.8rem;
        }

        /* Chat area styling */
        #chat-area { 
            background-color: #1e1a1a;
            color: var(--text-light); 
            border: 2px solid #3a2e2a;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
            height: 50vh;
        }
        
        @media (min-width: 768px) {
            #chat-area {
                height: 60vh;
            }
        }
        
        .message-box { 
            border-radius: 12px; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3); 
            padding: 1rem 1.5rem; 
            margin-bottom: 1rem;
            max-width: 90%;
            word-wrap: break-word;
        }
        
        .user-message { 
            background: linear-gradient(135deg, #2a3c5f 0%, #1e2a47 100%);
            color: var(--text-light); 
            margin-left: auto; 
            border: 1px solid #3a5278;
        }
        
        .ai-message { 
            background: linear-gradient(135deg, #3a2e2a 0%, #2a221f 100%);
            color: var(--text-light); 
            border-left: 6px solid var(--accent-gold);
            margin-right: auto; 
        }

        .combat-message {
            background: linear-gradient(135deg, #5a2e2e 0%, #3a1e1e 100%);
            border-left: 6px solid var(--accent-red);
        }

        .level-up-message {
            background: linear-gradient(135deg, #2e5a3a 0%, #1e3a2a 100%);
            border-left: 6px solid #44ff44;
        }

        .spell-message {
            background: linear-gradient(135deg, #2e3a5a 0%, #1e2a3a 100%);
            border-left: 6px solid var(--accent-blue);
        }

        /* Input and Button theme - CORRIGIDO PARA CELULAR */
        #user-input { 
            background-color: #2a221f; 
            border: 2px solid #3a2e2a; 
            color: var(--text-light); 
            font-size: 16px; /* Evita zoom no iOS */
            padding: 1rem;
            height: auto;
            min-height: 60px;
        }
        
        #send-button { 
            background: linear-gradient(135deg, var(--accent-gold) 0%, #b8941f 100%);
            color: var(--primary-dark); 
            border: 1px solid var(--accent-gold);
            padding: 1rem 1.5rem;
            white-space: nowrap;
        }

        .combat-button {
            background: linear-gradient(135deg, var(--accent-red) 0%, #a61e3a 100%);
            color: white;
            border: 1px solid var(--accent-red);
            padding: 0.75rem;
            font-size: 0.9rem;
        }

        .skill-button {
            background: linear-gradient(135deg, var(--accent-blue) 0%, #1e70ff 100%);
            color: white;
            border: 1px solid var(--accent-blue);
            padding: 0.75rem;
            font-size: 0.9rem;
        }

        .spell-button {
            background: linear-gradient(135deg, #8a2be2 0%, #6a1bb2 100%);
            color: white;
            border: 1px solid #8a2be2;
            padding: 0.75rem;
            font-size: 0.9rem;
        }

        /* Modal styling */
        #character-setup, #skills-modal, #relationships-modal, #attributes-modal { 
            z-index: 70; 
        }
        
        .modal-content { 
            background: linear-gradient(135deg, var(--primary-medium) 0%, var(--primary-dark) 100%);
            border: 2px solid var(--accent-gold); 
            max-height: 90vh;
            overflow-y: auto;
            margin: 1rem;
        }
        
        .modal-content h2 { 
            color: var(--accent-gold); 
        }

        /* Sidebar styling - MELHORADO PARA CELULAR */
        #sidebar { 
            position: fixed; 
            top: 0; 
            left: 0; 
            height: 100%; 
            width: 280px; 
            transform: translateX(-100%); 
            transition: transform 0.3s ease-in-out; 
            z-index: 50; 
            overflow-y: auto; 
            background: linear-gradient(135deg, var(--primary-medium) 0%, var(--primary-dark) 100%);
            border-right: 2px solid var(--accent-gold);
            padding-top: 4rem;
        }
        
        #sidebar.open { transform: translateX(0); }
        
        @media (min-width: 768px) { 
            #sidebar { 
                position: relative; 
                transform: translateX(0); 
                min-width: 300px; 
                width: 300px; 
                padding-top: 1rem;
            } 
        }
        
        #sidebar-toggle { 
            display: block; 
            position: fixed; 
            left: 1rem; 
            top: 1rem; 
            z-index: 60; 
            background-color: var(--accent-gold); 
            color: var(--primary-dark); 
            padding: 0.5rem; 
            border-radius: 50%; 
            width: 40px;
            height: 40px;
        }
        
        @media (min-width: 768px) { 
            #sidebar-toggle { display: none; } 
        }
        
        .sidebar-section { 
            background-color: rgba(35, 45, 60, 0.8); 
            border: 1px solid #5a4b3f; 
            border-radius: 8px; 
            padding: 0.75rem; 
            margin-bottom: 0.75rem; 
            font-size: 0.9rem;
        }
        
        .sidebar-section h3 { 
            font-family: 'Cinzel', serif; 
            color: var(--accent-gold); 
            font-size: 1.1rem; 
            margin-bottom: 0.5rem; 
        }

        /* Header buttons - AJUSTADO PARA CELULAR */
        .header-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            justify-content: center;
            margin-top: 0.5rem;
        }

        .header-button {
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            font-size: 0.7rem;
            white-space: nowrap;
        }

        /* Combat UI - AJUSTADO PARA CELULAR */
        #combat-ui {
            transition: all 0.3s ease;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .combat-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .skills-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        @media (min-width: 768px) {
            .skills-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Input section - CORRIGIDO */
        .input-section {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
            align-items: flex-end;
        }

        #user-input {
            flex: 1;
            min-height: 60px;
        }

        #send-button {
            height: fit-content;
            padding: 1rem 1.2rem;
        }

        /* Character creation - MELHORADO PARA CELULAR */
        .creation-section {
            margin-bottom: 1rem;
        }

        .creation-section-title {
            font-family: 'Cinzel', serif;
            color: var(--accent-gold);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
            padding-bottom: 0.25rem;
        }

        .class-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .class-card {
            background: rgba(42, 50, 69, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 0.5rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .class-card:hover {
            background: rgba(42, 50, 69, 1);
            border-color: var(--accent-gold);
            transform: translateY(-2px);
        }

        .class-card.selected {
            border-color: var(--accent-gold);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
            background: rgba(42, 50, 69, 1);
        }

        .class-icon-small {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .class-name {
            font-weight: bold;
            font-size: 0.8rem;
            margin-bottom: 0.25rem;
        }

        .class-desc {
            font-size: 0.65rem;
            color: var(--text-dim);
            line-height: 1.2;
        }

        /* Multiplayer styles */
        .online-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }

        .online {
            background-color: #44ff44;
            box-shadow: 0 0 5px #44ff44;
        }

        .offline {
            background-color: #ff4444;
        }

        .game-mode-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .mode-button {
            flex: 1;
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-button.active {
            border: 2px solid var(--accent-gold);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .singleplayer-mode {
            background: linear-gradient(135deg, #2a5a3a 0%, #1e3a2a 100%);
        }

        .multiplayer-mode {
            background: linear-gradient(135deg, #3a2a5a 0%, #2a1e3a 100%);
        }

        /* Progress bars */
        .progress-container {
            width: 100%;
            height: 12px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            overflow: hidden;
            margin-top: 4px;
        }

        .progress-bar {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        .hp-bar {
            background: linear-gradient(90deg, #c41e3a, #ff6b6b);
        }

        .mp-bar {
            background: linear-gradient(90deg, #1e90ff, #6bc5ff);
        }

        .xp-bar {
            background: linear-gradient(90deg, #d4af37, #ffd700);
        }

        /* Skills tree */
        .skill-node {
            background: rgba(42, 50, 69, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .skill-node:hover {
            background: rgba(42, 50, 69, 1);
            border-color: var(--accent-gold);
        }

        .skill-node.unlocked {
            border-color: var(--accent-gold);
            box-shadow: 0 0 5px rgba(212, 175, 55, 0.5);
        }

        .skill-node.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .skill-node.available {
            border-color: var(--accent-blue);
            box-shadow: 0 0 5px rgba(30, 144, 255, 0.5);
        }

        /* Relationships */
        .relationship-card {
            background: rgba(42, 50, 69, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .relationship-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .relationship-level {
            height: 8px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 4px;
        }

        .relationship-fill {
            height: 100%;
            border-radius: 4px;
            background: linear-gradient(90deg, #8a2be2, #b19cd9);
        }

        /* Story mode selector */
        .story-mode-selector {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .story-mode-card {
            background: rgba(42, 50, 69, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .story-mode-card:hover {
            background: rgba(42, 50, 69, 1);
            transform: translateY(-2px);
        }

        .story-mode-card.selected {
            border-color: var(--accent-gold);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .story-mode-title {
            font-family: 'Cinzel', serif;
            color: var(--accent-gold);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .story-mode-desc {
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        /* Attributes system */
        .attributes-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }

        .attribute-card {
            background: rgba(42, 50, 69, 0.8);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 0.5rem;
            text-align: center;
        }

        .attribute-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-gold);
            margin: 0.25rem 0;
        }

        .attribute-name {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .attribute-desc {
            font-size: 0.65rem;
            color: var(--text-dim);
            margin-top: 0.25rem;
        }

        .attribute-points {
            text-align: center;
            margin: 1rem 0;
            padding: 0.5rem;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 6px;
            border: 1px solid var(--accent-gold);
        }

        .attribute-points-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-gold);
        }
    </style>
</head>
<body class="h-screen overflow-hidden">

    <div class="flex flex-col h-full md:flex-row">

        <aside id="sidebar" class="p-4 flex flex-col pt-16">
            <h2 class="text-2xl font-bold text-center mb-6" style="font-family: 'Cinzel', serif; color: var(--accent-gold);">Detalhes da Aventura</h2>

            <!-- Seção Modo de Jogo -->
            <div class="sidebar-section">
                <h3>Modo de Jogo</h3>
                <div class="game-mode-buttons">
                    <div class="mode-button singleplayer-mode active" id="singleplayer-btn">
                        🎯 Singleplayer
                    </div>
                    <div class="mode-button multiplayer-mode" id="multiplayer-btn">
                        🎮 Multiplayer
                    </div>
                </div>
                <div id="multiplayer-info" class="text-sm">
                    <p class="text-gray-400 italic">Modo singleplayer ativo</p>
                </div>
            </div>

            <!-- Seção Personagem -->
            <div class="sidebar-section">
                <h3>Personagem</h3>
                <p><strong>Nome:</strong> <span id="sidebar-char-name" class="text-yellow-300">-</span></p>
                <p><strong>Classe:</strong> <span id="sidebar-char-role" class="text-white">-</span></p>
                <p><strong>Nível:</strong> <span id="sidebar-char-level" class="text-green-400">1</span></p>
                <p><strong>XP:</strong> <span id="sidebar-char-xp">0/100</span></p>
                <div class="progress-container">
                    <div id="xp-bar" class="progress-bar xp-bar" style="width: 0%"></div>
                </div>
            </div>

            <!-- Seção Atributos -->
            <div class="sidebar-section">
                <h3>Atributos</h3>
                <div class="attributes-grid">
                    <div class="attribute-card">
                        <div class="attribute-name">Força</div>
                        <div class="attribute-value" id="attr-strength">10</div>
                    </div>
                    <div class="attribute-card">
                        <div class="attribute-name">Destreza</div>
                        <div class="attribute-value" id="attr-dexterity">10</div>
                    </div>
                    <div class="attribute-card">
                        <div class="attribute-name">Constituição</div>
                        <div class="attribute-value" id="attr-constitution">10</div>
                    </div>
                    <div class="attribute-card">
                        <div class="attribute-name">Inteligência</div>
                        <div class="attribute-value" id="attr-intelligence">10</div>
                    </div>
                    <div class="attribute-card">
                        <div class="attribute-name">Sabedoria</div>
                        <div class="attribute-value" id="attr-wisdom">10</div>
                    </div>
                    <div class="attribute-card">
                        <div class="attribute-name">Carisma</div>
                        <div class="attribute-value" id="attr-charisma">10</div>
                    </div>
                </div>
            </div>

            <!-- Seção Vitalidade -->
            <div class="sidebar-section">
                <h3>Vitalidade</h3>
                <div class="space-y-2">
                    <div>
                        <p class="flex justify-between items-center text-red-400 text-sm">
                            <span>HP</span>
                            <span id="hp-value">100/100</span>
                        </p>
                        <div class="progress-container">
                            <div id="hp-bar" class="progress-bar hp-bar" style="width: 100%"></div>
                        </div>
                    </div>
                    <div>
                        <p class="flex justify-between items-center text-blue-400 text-sm">
                            <span>MP</span>
                            <span id="mp-value">50/50</span>
                        </p>
                        <div class="progress-container">
                            <div id="mp-bar" class="progress-bar mp-bar" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção Habilidades -->
            <div class="sidebar-section">
                <h3>Habilidades</h3>
                <ul id="skills-list" class="text-sm">
                    <li class="text-gray-400 italic">Nenhuma habilidade aprendida</li>
                </ul>
            </div>

            <!-- Seção Relacionamentos -->
            <div class="sidebar-section">
                <h3>Relacionamentos</h3>
                <div id="relationships-list">
                    <p class="text-gray-400 italic text-sm">Ainda não conheceu ninguém</p>
                </div>
            </div>

            <!-- Seção Inventário -->
            <div class="sidebar-section">
                <h3>Inventário</h3>
                <ul id="inventory-list" class="text-sm">
                    <li class="text-gray-400 italic">Inventário vazio</li>
                </ul>
            </div>

        </aside>

        <button id="sidebar-toggle">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                <path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1 0-1.5Z" clip-rule="evenodd" />
            </svg>
        </button>

        <div class="flex flex-col flex-grow p-2 md:p-4 h-full">
            <header id="main-header" class="text-center p-3 rounded-xl mb-2">
                <h1 class="tracking-wider">RPG Textual</h1>
                <div class="text-xs mt-1">
                    <p>Jogador: <span id="character-name-display" class="font-bold">...</span></p>
                    <div class="header-buttons">
                        <button id="audio-toggle-button" class="header-button bg-gray-700 hover:bg-gray-600 text-white">
                            🎵 Música
                        </button>
                        <button id="reset-game-button" class="header-button bg-red-700 hover:bg-red-600 text-white">
                            🔄 Novo
                        </button>
                        <button id="save-game-button" class="header-button bg-green-700 hover:bg-green-600 text-white">
                            💾 Salvar
                        </button>
                        <button id="skills-modal-button" class="header-button bg-purple-700 hover:bg-purple-600 text-white">
                            🌳 Skills
                        </button>
                        <button id="relationships-modal-button" class="header-button bg-pink-700 hover:bg-pink-600 text-white">
                            💝 Relações
                        </button>
                        <button id="attributes-modal-button" class="header-button bg-blue-700 hover:bg-blue-600 text-white">
                            📊 Atributos
                        </button>
                    </div>
                </div>
            </header>

            <!-- Interface de Combate -->
            <div id="combat-ui" class="hidden mb-3 p-3 rounded-xl bg-gray-800 border-2 border-red-600">
                <div class="text-center mb-3">
                    <h3 class="text-lg font-bold text-red-400 mb-1" id="enemy-name">Inimigo</h3>
                    <p class="text-xs text-gray-300" id="enemy-level">Nível: 1</p>
                </div>
                
                <div class="combat-actions">
                    <button id="attack-btn" class="combat-button">
                        ⚔️ Atacar
                    </button>
                    <button id="skill-btn" class="skill-button">
                        🎯 Skills
                    </button>
                    <button id="defend-btn" class="bg-gray-600 text-white py-2 px-4 rounded-lg font-bold text-sm">
                        🛡️ Defender
                    </button>
                    <button id="flee-btn" class="bg-yellow-600 text-white py-2 px-4 rounded-lg font-bold text-sm">
                        🏃 Fugir
                    </button>
                </div>

                <div class="mt-3 hidden" id="skills-section">
                    <h4 class="text-base font-bold text-purple-400 mb-1">🔮 Habilidades</h4>
                    <div class="skills-grid" id="skills-grid">
                        <!-- Habilidades serão adicionadas dinamicamente aqui -->
                    </div>
                </div>
            </div>

            <!-- Modal de Criação de Personagem -->
            <div id="character-setup" class="fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-2">
                <div class="modal-content p-4 rounded-xl w-full max-w-md">
                    <div class="text-center mb-4">
                        <h2 class="text-2xl font-bold mb-1" style="font-family: 'Cinzel', serif; color: var(--accent-gold);">Crie Seu Personagem</h2>
                        <p class="text-sm text-gray-300">Escolha seu modo de jogo e personagem</p>
                    </div>
                    
                    <!-- Seleção de Modo -->
                    <div class="creation-section">
                        <h3 class="creation-section-title">Modo de Jogo</h3>
                        <div class="game-mode-buttons">
                            <div class="mode-button singleplayer-mode active" id="setup-singleplayer-btn">
                                🎯 Singleplayer
                            </div>
                            <div class="mode-button multiplayer-mode" id="setup-multiplayer-btn">
                                🎮 Multiplayer
                            </div>
                        </div>
                    </div>

                    <!-- Seleção de Modo de História -->
                    <div class="creation-section">
                        <h3 class="creation-section-title">Modo de História</h3>
                        <div class="story-mode-selector">
                            <div class="story-mode-card selected" data-mode="sandbox">
                                <div class="story-mode-title">🏞️ Sandbox Livre</div>
                                <div class="story-mode-desc">Explore um mundo aberto com total liberdade para criar sua própria história. Sem limites para sua criatividade!</div>
                            </div>
                            <div class="story-mode-card" data-mode="narrative">
                                <div class="story-mode-title">📖 Narrativa Guiada</div>
                                <div class="story-mode-desc">Siga uma história complexa e bem estruturada com personagens profundos e reviravoltas emocionantes.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <!-- Nome do Personagem -->
                        <div class="creation-section">
                            <h3 class="creation-section-title">Nome do Personagem</h3>
                            <div class="space-y-2">
                                <input type="text" id="char-name-input" placeholder="Ex: Corvo, o Bardo" class="w-full p-2 rounded-lg bg-gray-800 text-white border border-gray-600 text-sm">
                                <div class="grid grid-cols-2 gap-2">
                                    <input type="number" id="char-age-input" placeholder="Idade" min="15" max="150" class="p-2 rounded-lg bg-gray-800 text-white border border-gray-600 text-sm">
                                    <select id="char-sex-input" class="p-2 rounded-lg bg-gray-800 text-white border border-gray-600 text-sm">
                                        <option value="">Sexo</option>
                                        <option value="Masculino">Masculino</option>
                                        <option value="Feminino">Feminino</option>
                                        <option value="Não-binário">Não-binário</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Escolha da Classe -->
                        <div class="creation-section">
                            <h3 class="creation-section-title">Escolha sua Classe</h3>
                            <div class="class-grid">
                                <div class="class-card" data-class="Guerreiro">
                                    <div class="class-icon-small">⚔️</div>
                                    <div class="class-name">Guerreiro</div>
                                    <div class="class-desc">Combate corpo a corpo</div>
                                </div>
                                <div class="class-card" data-class="Mago">
                                    <div class="class-icon-small">🔮</div>
                                    <div class="class-name">Mago</div>
                                    <div class="class-desc">Artes arcanas</div>
                                </div>
                                <div class="class-card" data-class="Arqueiro">
                                    <div class="class-icon-small">🏹</div>
                                    <div class="class-name">Arqueiro</div>
                                    <div class="class-desc">Ataques à distância</div>
                                </div>
                                <div class="class-card" data-class="Ladino">
                                    <div class="class-icon-small">🗡️</div>
                                    <div class="class-name">Ladino</div>
                                    <div class="class-desc">Furtividade</div>
                                </div>
                                <div class="class-card" data-class="Paladino">
                                    <div class="class-icon-small">🛡️</div>
                                    <div class="class-name">Paladino</div>
                                    <div class="class-desc">Poderes divinos</div>
                                </div>
                                <div class="class-card" data-class="Bardo">
                                    <div class="class-icon-small">🎵</div>
                                    <div class="class-name">Bardo</div>
                                    <div class="class-desc">Magia musical</div>
                                </div>
                                <div class="class-card" data-class="Druida">
                                    <div class="class-icon-small">🌿</div>
                                    <div class="class-name">Druida</div>
                                    <div class="class-desc">Natureza</div>
                                </div>
                                <div class="class-card" data-class="Necromante">
                                    <div class="class-icon-small">💀</div>
                                    <div class="class-name">Necromante</div>
                                    <div class="class-desc">Artes das trevas</div>
                                </div>
                            </div>
                        </div>

                        <!-- Distribuição de Atributos -->
                        <div class="creation-section">
                            <h3 class="creation-section-title">Atributos do Personagem</h3>
                            <div class="attribute-points">
                                <p class="text-sm">Pontos de Atributo Disponíveis:</p>
                                <div class="attribute-points-value" id="attribute-points">15</div>
                            </div>
                            <div class="attributes-grid">
                                <div class="attribute-card">
                                    <div class="attribute-name">Força</div>
                                    <div class="attribute-value" id="create-strength">10</div>
                                    <div class="flex justify-center gap-2 mt-1">
                                        <button class="attribute-minus bg-red-600 text-white w-6 h-6 rounded text-xs" data-attribute="strength">-</button>
                                        <button class="attribute-plus bg-green-600 text-white w-6 h-6 rounded text-xs" data-attribute="strength">+</button>
                                    </div>
                                    <div class="attribute-desc">Ataque físico</div>
                                </div>
                                <div class="attribute-card">
                                    <div class="attribute-name">Destreza</div>
                                    <div class="attribute-value" id="create-dexterity">10</div>
                                    <div class="flex justify-center gap-2 mt-1">
                                        <button class="attribute-minus bg-red-600 text-white w-6 h-6 rounded text-xs" data-attribute="dexterity">-</button>
                                        <button class="attribute-plus bg-green-600 text-white w-6 h-6 rounded text-xs" data-attribute="dexterity">+</button>
                                    </div>
                                    <div class="attribute-desc">Precisão e agilidade</div>
                                </div>
                                <div class="attribute-card">
                                    <div class="attribute-name">Constituição</div>
                                    <div class="attribute-value" id="create-constitution">10</div>
                                    <div class="flex justify-center gap-2 mt-1">
                                        <button class="attribute-minus bg-red-600 text-white w-6 h-6 rounded text-xs" data-attribute="constitution">-</button>
                                        <button class="attribute-plus bg-green-600 text-white w-6 h-6 rounded text-xs" data-attribute="constitution">+</button>
                                    </div>
                                    <div class="attribute-desc">Vida e resistência</div>
                                </div>
                                <div class="attribute-card">
                                    <div class="attribute-name">Inteligência</div>
                                    <div class="attribute-value" id="create-intelligence">10</div>
                                    <div class="flex justify-center gap-2 mt-1">
                                        <button class="attribute-minus bg-red-600 text-white w-6 h-6 rounded text-xs" data-attribute="intelligence">-</button>
                                        <button class="attribute-plus bg-green-600 text-white w-6 h-6 rounded text-xs" data-attribute="intelligence">+</button>
                                    </div>
                                    <div class="attribute-desc">Magia e conhecimento</div>
                                </div>
                                <div class="attribute-card">
                                    <div class="attribute-name">Sabedoria</div>
                                    <div class="attribute-value" id="create-wisdom">10</div>
                                    <div class="flex justify-center gap-2 mt-1">
                                        <button class="attribute-minus bg-red-600 text-white w-6 h-6 rounded text-xs" data-attribute="wisdom">-</button>
                                        <button class="attribute-plus bg-green-600 text-white w-6 h-6 rounded text-xs" data-attribute="wisdom">+</button>
                                    </div>
                                    <div class="attribute-desc">Percepção e intuição</div>
                                </div>
                                <div class="attribute-card">
                                    <div class="attribute-name">Carisma</div>
                                    <div class="attribute-value" id="create-charisma">10</div>
                                    <div class="flex justify-center gap-2 mt-1">
                                        <button class="attribute-minus bg-red-600 text-white w-6 h-6 rounded text-xs" data-attribute="charisma">-</button>
                                        <button class="attribute-plus bg-green-600 text-white w-6 h-6 rounded text-xs" data-attribute="charisma">+</button>
                                    </div>
                                    <div class="attribute-desc">Persuasão e liderança</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-600 mt-4 pt-3 text-center">
                        <button id="save-character-button" class="w-full font-bold py-2 rounded-lg bg-yellow-600 hover:bg-yellow-700 text-white text-base">
                            Começar Aventura!
                        </button>
                    </div>
                </div>
            </div>

            <!-- Modal de Árvore de Habilidades -->
            <div id="skills-modal" class="fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-2 hidden">
                <div class="modal-content p-4 rounded-xl w-full max-w-2xl">
                    <div class="text-center mb-4">
                        <h2 class="text-2xl font-bold mb-1" style="font-family: 'Cinzel', serif; color: var(--accent-gold);">Árvore de Habilidades</h2>
                        <p class="text-sm text-gray-300">Desbloqueie novas habilidades com pontos de habilidade</p>
                    </div>
                    
                    <div class="mb-4 text-center">
                        <p class="text-lg font-bold text-blue-400">Pontos de Habilidade Disponíveis: <span id="skill-points">0</span></p>
                    </div>
                    
                    <div id="skills-tree" class="space-y-3">
                        <!-- Árvore de habilidades será gerada aqui -->
                    </div>
                    
                    <div class="border-t border-gray-600 mt-4 pt-3 text-center">
                        <button id="close-skills-button" class="font-bold py-2 px-4 rounded-lg bg-gray-600 hover:bg-gray-700 text-white text-base">
                            Fechar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Modal de Relacionamentos -->
            <div id="relationships-modal" class="fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-2 hidden">
                <div class="modal-content p-4 rounded-xl w-full max-w-md">
                    <div class="text-center mb-4">
                        <h2 class="text-2xl font-bold mb-1" style="font-family: 'Cinzel', serif; color: var(--accent-gold);">Relacionamentos</h2>
                        <p class="text-sm text-gray-300">Suas conexões com outros personagens</p>
                    </div>
                    
                    <div id="relationships-modal-content">
                        <p class="text-gray-400 italic text-center py-4">Ainda não conheceu ninguém</p>
                    </div>
                    
                    <div class="border-t border-gray-600 mt-4 pt-3 text-center">
                        <button id="close-relationships-button" class="font-bold py-2 px-4 rounded-lg bg-gray-600 hover:bg-gray-700 text-white text-base">
                            Fechar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Modal de Atributos -->
            <div id="attributes-modal" class="fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-2 hidden">
                <div class="modal-content p-4 rounded-xl w-full max-w-md">
                    <div class="text-center mb-4">
                        <h2 class="text-2xl font-bold mb-1" style="font-family: 'Cinzel', serif; color: var(--accent-gold);">Atributos do Personagem</h2>
                        <p class="text-sm text-gray-300">Seus atributos principais</p>
                    </div>
                    
                    <div class="attributes-grid">
                        <div class="attribute-card">
                            <div class="attribute-name">Força</div>
                            <div class="attribute-value" id="modal-strength">10</div>
                            <div class="attribute-desc">Ataque físico e carga</div>
                        </div>
                        <div class="attribute-card">
                            <div class="attribute-name">Destreza</div>
                            <div class="attribute-value" id="modal-dexterity">10</div>
                            <div class="attribute-desc">Precisão e agilidade</div>
                        </div>
                        <div class="attribute-card">
                            <div class="attribute-name">Constituição</div>
                            <div class="attribute-value" id="modal-constitution">10</div>
                            <div class="attribute-desc">Vida e resistência</div>
                        </div>
                        <div class="attribute-card">
                            <div class="attribute-name">Inteligência</div>
                            <div class="attribute-value" id="modal-intelligence">10</div>
                            <div class="attribute-desc">Magia e conhecimento</div>
                        </div>
                        <div class="attribute-card">
                            <div class="attribute-name">Sabedoria</div>
                            <div class="attribute-value" id="modal-wisdom">10</div>
                            <div class="attribute-desc">Percepção e intuição</div>
                        </div>
                        <div class="attribute-card">
                            <div class="attribute-name">Carisma</div>
                            <div class="attribute-value" id="modal-charisma">10</div>
                            <div class="attribute-desc">Persuasão e liderança</div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-600 mt-4 pt-3 text-center">
                        <button id="close-attributes-button" class="font-bold py-2 px-4 rounded-lg bg-gray-600 hover:bg-gray-700 text-white text-base">
                            Fechar
                        </button>
                    </div>
                </div>
            </div>

            <main class="flex flex-col flex-grow min-h-0">
                <div id="chat-area" class="flex-grow p-3 rounded-xl overflow-y-auto mb-2">
                    <div class="text-center text-gray-500 italic py-8">
                        Crie seu personagem para começar a aventura...
                    </div>
                </div>
            </main>

            <!-- ÁREA DE INPUT CORRIGIDA -->
            <section class="input-section">
                <input type="text" id="user-input" placeholder="Digite sua ação..." class="flex-grow p-3 rounded-xl bg-gray-800 text-white border border-gray-600" disabled>
                <button id="send-button" class="font-bold rounded-xl" disabled>
                    Enviar
                </button>
            </section>
        </div>
    </div>

    <script>
        // =============================================
        // SISTEMA DE MODO DE JOGO
        // =============================================

        let gameMode = 'singleplayer'; // 'singleplayer' ou 'multiplayer'
        let storyMode = 'sandbox'; // 'sandbox' ou 'narrative'

        // Elementos DOM
        const singleplayerBtn = document.getElementById('singleplayer-btn');
        const multiplayerBtn = document.getElementById('multiplayer-btn');
        const setupSingleplayerBtn = document.getElementById('setup-singleplayer-btn');
        const setupMultiplayerBtn = document.getElementById('setup-multiplayer-btn');
        const multiplayerInfo = document.getElementById('multiplayer-info');

        // Função para mudar modo de jogo
        function setGameMode(mode) {
            gameMode = mode;
            
            // Atualizar botões da sidebar
            if (mode === 'singleplayer') {
                singleplayerBtn.classList.add('active');
                multiplayerBtn.classList.remove('active');
                multiplayerInfo.innerHTML = '<p class="text-gray-400 italic">Modo singleplayer ativo</p>';
            } else {
                singleplayerBtn.classList.remove('active');
                multiplayerBtn.classList.add('active');
                multiplayerInfo.innerHTML = `
                    <p class="text-yellow-400">Modo multiplayer</p>
                    <p class="text-xs text-gray-400">Firebase não configurado</p>
                    <button class="w-full mt-1 px-2 py-1 rounded text-white text-xs bg-blue-600 hover:bg-blue-700">
                        Configurar
                    </button>
                `;
            }

            // Atualizar botões do setup
            if (mode === 'singleplayer') {
                setupSingleplayerBtn.classList.add('active');
                setupMultiplayerBtn.classList.remove('active');
            } else {
                setupSingleplayerBtn.classList.remove('active');
                setupMultiplayerBtn.classList.add('active');
            }

            console.log(`Modo de jogo alterado para: ${mode}`);
        }

        // Event Listeners para mudança de modo
        singleplayerBtn.addEventListener('click', () => setGameMode('singleplayer'));
        multiplayerBtn.addEventListener('click', () => setGameMode('multiplayer'));
        setupSingleplayerBtn.addEventListener('click', () => setGameMode('singleplayer'));
        setupMultiplayerBtn.addEventListener('click', () => setGameMode('multiplayer'));

        // Seleção de modo de história
        document.querySelectorAll('.story-mode-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.story-mode-card').forEach(c => {
                    c.classList.remove('selected');
                });
                card.classList.add('selected');
                storyMode = card.getAttribute('data-mode');
                console.log(`Modo de história alterado para: ${storyMode}`);
            });
        });

        // =============================================
        // SISTEMA DE ATRIBUTOS
        // =============================================

        let attributePoints = 15;
        let attributes = {
            strength: 10,
            dexterity: 10,
            constitution: 10,
            intelligence: 10,
            wisdom: 10,
            charisma: 10
        };

        // Atualizar display dos atributos
        function updateAttributeDisplay() {
            // Atualizar criação de personagem
            document.getElementById('create-strength').textContent = attributes.strength;
            document.getElementById('create-dexterity').textContent = attributes.dexterity;
            document.getElementById('create-constitution').textContent = attributes.constitution;
            document.getElementById('create-intelligence').textContent = attributes.intelligence;
            document.getElementById('create-wisdom').textContent = attributes.wisdom;
            document.getElementById('create-charisma').textContent = attributes.charisma;
            document.getElementById('attribute-points').textContent = attributePoints;

            // Atualizar sidebar
            document.getElementById('attr-strength').textContent = attributes.strength;
            document.getElementById('attr-dexterity').textContent = attributes.dexterity;
            document.getElementById('attr-constitution').textContent = attributes.constitution;
            document.getElementById('attr-intelligence').textContent = attributes.intelligence;
            document.getElementById('attr-wisdom').textContent = attributes.wisdom;
            document.getElementById('attr-charisma').textContent = attributes.charisma;

            // Atualizar modal
            document.getElementById('modal-strength').textContent = attributes.strength;
            document.getElementById('modal-dexterity').textContent = attributes.dexterity;
            document.getElementById('modal-constitution').textContent = attributes.constitution;
            document.getElementById('modal-intelligence').textContent = attributes.intelligence;
            document.getElementById('modal-wisdom').textContent = attributes.wisdom;
            document.getElementById('modal-charisma').textContent = attributes.charisma;
        }

        // Sistema de pontos de atributo
        document.querySelectorAll('.attribute-plus').forEach(button => {
            button.addEventListener('click', (e) => {
                if (attributePoints <= 0) return;
                
                const attribute = e.target.getAttribute('data-attribute');
                attributes[attribute]++;
                attributePoints--;
                updateAttributeDisplay();
            });
        });

        document.querySelectorAll('.attribute-minus').forEach(button => {
            button.addEventListener('click', (e) => {
                const attribute = e.target.getAttribute('data-attribute');
                if (attributes[attribute] <= 8) return; // Mínimo de 8
                
                attributes[attribute]--;
                attributePoints++;
                updateAttributeDisplay();
            });
        });

        // =============================================
        // SISTEMA DO JOGO (SINGLEPLAYER)
        // =============================================

        // Estado do jogo
        let localCharacterProfile = null;
        let chatMessages = [];
        let isAudioPlaying = false;
        let currentEnemy = null;
        let isInCombat = false;
        let selectedClass = null;
        let skillPoints = 0;
        let relationships = {};

        // Elementos DOM principais
        const chatArea = document.getElementById('chat-area');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const characterSetupModal = document.getElementById('character-setup');
        const saveCharacterButton = document.getElementById('save-character-button');
        const charNameInput = document.getElementById('char-name-input');
        const charAgeInput = document.getElementById('char-age-input');
        const charSexInput = document.getElementById('char-sex-input');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');
        const skillsModal = document.getElementById('skills-modal');
        const relationshipsModal = document.getElementById('relationships-modal');
        const attributesModal = document.getElementById('attributes-modal');
        const skillsModalButton = document.getElementById('skills-modal-button');
        const relationshipsModalButton = document.getElementById('relationships-modal-button');
        const attributesModalButton = document.getElementById('attributes-modal-button');
        const closeSkillsButton = document.getElementById('close-skills-button');
        const closeRelationshipsButton = document.getElementById('close-relationships-button');
        const closeAttributesButton = document.getElementById('close-attributes-button');

        // Sistema de mensagens
        function addMessage(text, sender, type = 'normal') {
            const messageDiv = document.createElement('div');
            let messageClass = `message-box ${sender === 'user' ? 'user-message' : 'ai-message'}`;
            
            if (type === 'combat') {
                messageClass += ' combat-message';
            } else if (type === 'level-up') {
                messageClass += ' level-up-message';
            } else if (type === 'spell') {
                messageClass += ' spell-message';
            }
            
            messageDiv.className = messageClass;
            messageDiv.innerHTML = `
                <div class="font-bold text-sm mb-1">${sender === 'user' ? 'Você' : 'Mestre IA'}</div>
                <div class="whitespace-pre-wrap text-sm">${text}</div>
            `;
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
            
            chatMessages.push({ text, sender, type });
        }

        // Histórias iniciais diferentes para cada modo
        function getInitialStory() {
            const stories = {
                sandbox: [
                    `Bem-vindo ao Mundo Aberto de Eldoria, ${localCharacterProfile.name}! Como ${localCharacterProfile.role}, você tem liberdade total para explorar este vasto continente. 

🌍 **O QUE VOCÊ PODE FAZER:**
• Explorar cidades esquecidas e florestas encantadas
• Enfrentar criaturas míticas ou negociar com elas
• Seguir rumores de tesouros perdidos
• Criar sua própria lenda do zero

O destino de Eldoria está em suas mãos. Onde sua jornada começará?`,

                    `No Reino de Aethelgard, ${localCharacterProfile.name}, sua reputação como ${localCharacterProfile.role} precede você. O mundo está repleto de oportunidades!

🗺️ **POSSIBILIDADES INFINITAS:**
• Fundar uma guilda de aventureiros
• Descobrir segredos arcanos em bibliotecas proibidas
• Negociar alianças entre reinos em conflito
• Explorar masmorras abandonadas cheias de mistérios

Sua criatividade é o único limite. Qual será seu primeiro passo nessa terra de maravilhas?`,

                    `A terra de Veridia acorda sob seu olhar, ${localCharacterProfile.name}. Como ${localCharacterProfile.role}, você moldará o destino deste mundo.

🌄 **UM MUNDO PARA EXPLORAR:**
• Cidades flutuantes que desafiam a gravidade
• Florestas onde as árvores sussurram segredos antigos
• Oceanos habitados por civilizações submarinas
• Planícies onde dragons ainda reinam supremos

Cada escolha sua escreverá uma página única na história de Veridia. O que você fará primeiro?`
                ],
                narrative: [
                    `A Profecia do Eclipse começa a se desenrolar, ${localCharacterProfile.name}. Como ${localCharacterProfile.role}, você é peça central em eventos que abalarão os alicerces de Eldoria.

📜 **O ENREDO SE DESDOBRA:**
Há séculos, os Três Sábios previram que durante o Grande Eclipse, um herói surgiria para enfrentar as Sombras que consomem o mundo. Sinais mostram que o Eclipse se aproxima, e sombras estranhas já assolam as fronteiras.

Você acorda com uma marca misteriosa na mão - o Sinal dos Escolhidos. Um mensageiro real chegou com urgência: o Rei Alaric solicita sua presença no Castelo da Aurora.

O que você faz?`,

                    `No crepúsculo do Quinto Reino, ${localCharacterProfile.name}, sua jornada como ${localCharacterProfile.role} está prestes a mudar o curso da história.

🎭 **DRAMA EM DESENVOLVIMENTO:**
A Ordem dos Magos foi traída por dentro. O Arquimago Valerius desapareceu, e runas de advertência apareceram em todas as torres de vigia. Rumores falam de um exército de sombras se reunindo nas Terras Sussurrantes.

Você possui um artefato ancestral que pertenceu ao primeiro ${localCharacterProfile.role} - a Chama de ${localCharacterProfile.name.split(' ')[0]}. Esta relíquia pode ser a chave para salvar o reino... ou destruí-lo.

Enquanto se prepara para partir, um estranho encapuzado entrega um bilhete ensanguentado: "Eles sabem sobre a chama. Corra."

Para onde você vai?`,

                    `O Chamado dos Deuses Antigos ecoa em seus sonhos, ${localCharacterProfile.name}. Como ${localCharacterProfile.role}, você é o elo entre mundos que estão se separando.

⚡ **UMA MISSÃO ÉPICA:**
Os portais entre os reinos estão se fechando, e a magia está desaparecendo de Eldoria. Os Deuses Antigos, outrora adormecidos, despertaram com fúria, acusando os mortais de roubarem a essência divina.

Você é o último descendente da linhagem dos Guardiões dos Portais. Sua avó, na beira da morte, confessou que sua família guarda um segredo capaz de restaurar o equilíbrio - ou condenar todos os reinos ao esquecimento.

O Conselho dos Magos o convoca, mas os Sacerdotes dos Deuses Antigos exigem sua presença no Templo Proibido. Quem você atenderá primeiro?`
                ]
            };

            const modeStories = stories[storyMode];
            return modeStories[Math.floor(Math.random() * modeStories.length)];
        }

        // Enviar mensagem
        function sendMessage() {
            const text = userInput.value.trim();
            if (!text || !localCharacterProfile) return;
            
            addMessage(text, 'user');
            userInput.value = '';
            
            // Resposta do Mestre IA baseada no modo de história
            setTimeout(() => {
                let response;
                
                if (storyMode === 'sandbox') {
                    const sandboxResponses = [
                        "Sua criatividade molda o mundo ao seu redor. O que mais você gostaria de explorar?",
                        "O cenário se adapta às suas escolhas. Continue sua jornada!",
                        "Sua liberdade é ilimitada. O que você deseja fazer a seguir?",
                        "O universo responde à sua imaginação. Sua ação tem consequências interessantes..."
                    ];
                    response = sandboxResponses[Math.floor(Math.random() * sandboxResponses.length)];
                } else {
                    const narrativeResponses = [
                        "Sua ação avança a trama de maneira inesperada. Os personagens ao seu redor reagem de acordo.",
                        "A história se desenrola com suas escolhas. Um novo capítulo se inicia...",
                        "Seus relacionamentos com outros personagens evoluem baseados em suas decisões.",
                        "A narrativa se aprofunda. Você sente que está se aproximando de um momento crucial..."
                    ];
                    response = narrativeResponses[Math.floor(Math.random() * narrativeResponses.length)];
                }
                
                addMessage(response, 'ai');
                
                // Chance de encontrar inimigo com lógica coerente
                if (Math.random() < 0.3) {
                    const enemies = [
                        { name: "Goblin Saqueador", level: 1, reason: "procurando por comida" },
                        { name: "Lobo do Bosque", level: 2, reason: "defendendo seu território" },
                        { name: "Bandido Errante", level: 3, reason: "buscando vítimas para roubar" },
                        { name: "Esqueleto Amaldiçoado", level: 4, reason: "guardião de uma tumba ancestral" }
                    ];
                    const enemy = enemies[Math.floor(Math.random() * enemies.length)];
                    
                    addMessage(`⚠️ **${enemy.name}** aparece! Ele está ${enemy.reason}. Prepare-se para o combate!`, 'ai', 'combat');
                    startCombat(enemy);
                }
                
                // Chance de ganhar XP
                if (Math.random() < 0.4) {
                    gainXP(10 + Math.floor(Math.random() * 20));
                }
                
                // Chance de encontrar NPC e desenvolver relacionamento
                if (Math.random() < 0.25) {
                    const npcs = [
                        { name: "Eldrin, o Sábio", description: "Um mago ancião com conhecimento arcano" },
                        { name: "Lyra, a Caçadora", description: "Uma rastreadora habilidosa da floresta" },
                        { name: "Thorn, o Ferreiro", description: "Um artesão que forja armas lendárias" },
                        { name: "Seraphina, a Curandeira", description: "Uma sacerdotisa com dons de cura" }
                    ];
                    const npc = npcs[Math.floor(Math.random() * npcs.length)];
                    
                    if (!relationships[npc.name]) {
                        relationships[npc.name] = {
                            level: 10,
                            description: npc.description
                        };
                        updateRelationshipsUI();
                        addMessage(`💝 Você conheceu **${npc.name}**! ${npc.description}`, 'ai');
                    } else {
                        // Aumentar relacionamento existente
                        relationships[npc.name].level = Math.min(100, relationships[npc.name].level + 5);
                        updateRelationshipsUI();
                        addMessage(`💝 Sua relação com **${npc.name}** melhorou!`, 'ai');
                    }
                }
            }, 1000);
        }

        // Sistema de XP e Level Up
        function gainXP(amount) {
            if (!localCharacterProfile) return;
            
            localCharacterProfile.xp += amount;
            const xpNeeded = localCharacterProfile.level * 100;
            
            // Atualizar UI
            document.getElementById('sidebar-char-xp').textContent = `${localCharacterProfile.xp}/${xpNeeded}`;
            document.getElementById('xp-bar').style.width = `${Math.min(100, (localCharacterProfile.xp / xpNeeded) * 100)}%`;
            
            // Verificar level up
            if (localCharacterProfile.xp >= xpNeeded) {
                levelUp();
            }
        }
        
        function levelUp() {
            localCharacterProfile.level++;
            localCharacterProfile.xp = 0;
            skillPoints += 2;
            
            // Aumentar stats baseado nos atributos
            localCharacterProfile.maxHP = 90 + (attributes.constitution * 5);
            localCharacterProfile.currentHP = localCharacterProfile.maxHP;
            localCharacterProfile.maxMP = 30 + (attributes.intelligence * 4);
            localCharacterProfile.currentMP = localCharacterProfile.maxMP;
            
            // Atualizar UI
            document.getElementById('sidebar-char-level').textContent = localCharacterProfile.level;
            document.getElementById('sidebar-char-xp').textContent = `0/${localCharacterProfile.level * 100}`;
            document.getElementById('xp-bar').style.width = '0%';
            updateHealthBars();
            
            addMessage(`🎉 **LEVEL UP!** Você alcançou o nível ${localCharacterProfile.level}! Ganhou 2 pontos de habilidade.`, 'ai', 'level-up');
        }

        // Atualizar barras de saúde
        function updateHealthBars() {
            if (!localCharacterProfile) return;
            
            const hpPercent = (localCharacterProfile.currentHP / localCharacterProfile.maxHP) * 100;
            const mpPercent = (localCharacterProfile.currentMP / localCharacterProfile.maxMP) * 100;
            
            document.getElementById('hp-bar').style.width = `${hpPercent}%`;
            document.getElementById('mp-bar').style.width = `${mpPercent}%`;
            document.getElementById('hp-value').textContent = `${localCharacterProfile.currentHP}/${localCharacterProfile.maxHP}`;
            document.getElementById('mp-value').textContent = `${localCharacterProfile.currentMP}/${localCharacterProfile.maxMP}`;
        }

        // Criar personagem
        function saveCharacterProfile() {
            const name = charNameInput.value.trim();
            const age = charAgeInput.value;
            const sex = charSexInput.value;
            const role = selectedClass;
            
            if (!name || !age || !sex || !role) {
                alert('Por favor, preencha todos os campos!');
                return;
            }
            
            // Calcular stats baseados nos atributos
            const baseHP = 90 + (attributes.constitution * 5);
            const baseMP = 30 + (attributes.intelligence * 4);
            
            localCharacterProfile = {
                name: name,
                age: age,
                sex: sex,
                role: role,
                level: 1,
                xp: 0,
                maxHP: baseHP,
                currentHP: baseHP,
                maxMP: baseMP,
                currentMP: baseMP,
                inventory: ["Poção de Cura"],
                skills: ["Ataque Básico"],
                attributes: {...attributes}
            };
            
            // Inicializar pontos de habilidade
            skillPoints = 0;
            
            // Fechar modal e atualizar UI
            characterSetupModal.style.display = 'none';
            document.getElementById('character-name-display').textContent = `${name} (${role})`;
            document.getElementById('sidebar-char-name').textContent = name;
            document.getElementById('sidebar-char-role').textContent = role;
            document.getElementById('sidebar-char-level').textContent = '1';
            document.getElementById('sidebar-char-xp').textContent = '0/100';
            
            // Atualizar atributos na sidebar
            updateAttributeDisplay();
            
            // Atualizar habilidades na sidebar
            updateSkillsList();
            
            // Habilitar chat
            userInput.disabled = false;
            userInput.placeholder = `Digite sua ação (Modo: ${storyMode === 'sandbox' ? 'Sandbox Livre' : 'Narrativa Guiada'})...`;
            sendButton.disabled = false;
            
            // Gerar história inicial baseada no modo
            const initialStory = getInitialStory();
            addMessage(initialStory, 'ai');
            
            // Inicializar árvore de habilidades
            initializeSkillsTree();
        }

        // Atualizar lista de habilidades na sidebar
        function updateSkillsList() {
            const skillsList = document.getElementById('skills-list');
            skillsList.innerHTML = '';
            
            if (localCharacterProfile.skills.length === 0) {
                skillsList.innerHTML = '<li class="text-gray-400 italic">Nenhuma habilidade aprendida</li>';
            } else {
                localCharacterProfile.skills.forEach(skill => {
                    const li = document.createElement('li');
                    li.textContent = skill;
                    li.className = 'text-white';
                    skillsList.appendChild(li);
                });
            }
        }

        // Inicializar árvore de habilidades
        function initializeSkillsTree() {
            const skillsTree = document.getElementById('skills-tree');
            skillsTree.innerHTML = '';
            
            const skillsData = {
                'Guerreiro': [
                    { id: 'warrior1', name: 'Golpe Poderoso', description: 'Um ataque que causa dano extra', cost: 1, requires: [] },
                    { id: 'warrior2', name: 'Postura Defensiva', description: 'Aumenta sua defesa por um turno', cost: 1, requires: ['warrior1'] },
                    { id: 'warrior3', name: 'Fúria do Guerreiro', description: 'Aumenta o dano por vários turnos', cost: 2, requires: ['warrior1'] },
                    { id: 'warrior4', name: 'Golpe Esmagador', description: 'Ataque que pode atordoar o inimigo', cost: 2, requires: ['warrior2', 'warrior3'] }
                ],
                'Mago': [
                    { id: 'mage1', name: 'Bola de Fogo', description: 'Lança uma esfera de fogo no inimigo', cost: 1, requires: [] },
                    { id: 'mage2', name: 'Escudo Arcano', description: 'Cria uma barreira mágica protetora', cost: 1, requires: ['mage1'] },
                    { id: 'mage3', name: 'Raio do Caos', description: 'Um raio de energia caótica', cost: 2, requires: ['mage1'] },
                    { id: 'mage4', name: 'Tempestade Arcana', description: 'Dano em área a todos os inimigos', cost: 3, requires: ['mage2', 'mage3'] }
                ],
                'Arqueiro': [
                    { id: 'archer1', name: 'Tiro Certeiro', description: 'Um tiro que nunca erra', cost: 1, requires: [] },
                    { id: 'archer2', name: 'Chuva de Flechas', description: 'Dispara múltiplas flechas', cost: 1, requires: ['archer1'] },
                    { id: 'archer3', name: 'Flecha Envenenada', description: 'Causa dano contínuo', cost: 2, requires: ['archer1'] },
                    { id: 'archer4', name: 'Tiro Perfurante', description: 'Atravessa a defesa do inimigo', cost: 2, requires: ['archer2', 'archer3'] }
                ],
                'Ladino': [
                    { id: 'rogue1', name: 'Ataque Furtivo', description: 'Dano extra quando o inimigo está distraído', cost: 1, requires: [] },
                    { id: 'rogue2', name: 'Esquiva', description: 'Aumenta chance de evitar ataques', cost: 1, requires: ['rogue1'] },
                    { id: 'rogue3', name: 'Veneno', description: 'Aplica veneno nas armas', cost: 2, requires: ['rogue1'] },
                    { id: 'rogue4', name: 'Golpe Traiçoeiro', description: 'Ataque crítico garantido', cost: 3, requires: ['rogue2', 'rogue3'] }
                ]
            };
            
            const classSkills = skillsData[localCharacterProfile.role] || skillsData['Guerreiro'];
            
            classSkills.forEach(skill => {
                const skillNode = document.createElement('div');
                const isUnlocked = localCharacterProfile.skills.includes(skill.name);
                const isAvailable = skill.requires.every(req => 
                    localCharacterProfile.skills.some(s => 
                        classSkills.find(sk => sk.id === req).name === s
                    )
                );
                
                let nodeClass = 'skill-node';
                if (isUnlocked) {
                    nodeClass += ' unlocked';
                } else if (isAvailable && skillPoints >= skill.cost) {
                    nodeClass += ' available';
                } else {
                    nodeClass += ' locked';
                }
                
                skillNode.className = nodeClass;
                skillNode.innerHTML = `
                    <div class="font-bold">${skill.name}</div>
                    <div class="text-xs text-gray-300">${skill.description}</div>
                    <div class="text-xs mt-1">Custo: ${skill.cost} ponto(s)</div>
                `;
                
                if (!isUnlocked && isAvailable && skillPoints >= skill.cost) {
                    skillNode.addEventListener('click', () => {
                        unlockSkill(skill);
                    });
                }
                
                skillsTree.appendChild(skillNode);
            });
            
            document.getElementById('skill-points').textContent = skillPoints;
        }

        // Desbloquear habilidade
        function unlockSkill(skill) {
            if (skillPoints < skill.cost) return;
            
            skillPoints -= skill.cost;
            localCharacterProfile.skills.push(skill.name);
            
            updateSkillsList();
            initializeSkillsTree();
            
            addMessage(`🎯 Você aprendeu a habilidade: **${skill.name}**!`, 'ai');
        }

        // Atualizar relacionamentos na UI
        function updateRelationshipsUI() {
            const relationshipsList = document.getElementById('relationships-list');
            const modalContent = document.getElementById('relationships-modal-content');
            
            if (Object.keys(relationships).length === 0) {
                relationshipsList.innerHTML = '<p class="text-gray-400 italic text-sm">Ainda não conheceu ninguém</p>';
                modalContent.innerHTML = '<p class="text-gray-400 italic text-center py-4">Ainda não conheceu ninguém</p>';
            } else {
                relationshipsList.innerHTML = '';
                modalContent.innerHTML = '';
                
                Object.entries(relationships).forEach(([name, data]) => {
                    // Sidebar (apenas nome e nível)
                    const relationshipItem = document.createElement('div');
                    relationshipItem.className = 'text-sm mb-1';
                    relationshipItem.innerHTML = `
                        <span class="font-bold">${name}</span>: ${data.level}/100
                    `;
                    relationshipsList.appendChild(relationshipItem);
                    
                    // Modal (detalhes completos)
                    const relationshipCard = document.createElement('div');
                    relationshipCard.className = 'relationship-card';
                    relationshipCard.innerHTML = `
                        <div class="relationship-name">${name}</div>
                        <div class="text-xs text-gray-300 mb-2">${data.description}</div>
                        <div class="relationship-level">
                            <div class="relationship-fill" style="width: ${data.level}%"></div>
                        </div>
                        <div class="text-xs mt-1 text-right">${data.level}/100</div>
                    `;
                    modalContent.appendChild(relationshipCard);
                });
            }
        }

        // Event Listeners para seleção de classe
        document.querySelectorAll('.class-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.class-card').forEach(c => {
                    c.classList.remove('selected');
                });
                card.classList.add('selected');
                selectedClass = card.getAttribute('data-class');
            });
        });

        // Event Listeners para modais
        skillsModalButton.addEventListener('click', () => {
            skillsModal.classList.remove('hidden');
        });

        relationshipsModalButton.addEventListener('click', () => {
            relationshipsModal.classList.remove('hidden');
        });

        attributesModalButton.addEventListener('click', () => {
            attributesModal.classList.remove('hidden');
        });

        closeSkillsButton.addEventListener('click', () => {
            skillsModal.classList.add('hidden');
        });

        closeRelationshipsButton.addEventListener('click', () => {
            relationshipsModal.classList.add('hidden');
        });

        closeAttributesButton.addEventListener('click', () => {
            attributesModal.classList.add('hidden');
        });

        // Event Listeners principais
        saveCharacterButton.addEventListener('click', saveCharacterProfile);
        sendButton.addEventListener('click', sendMessage);
        sidebarToggle.addEventListener('click', () => sidebar.classList.toggle('open'));

        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Inicialização
        characterSetupModal.style.display = 'flex';
        updateAttributeDisplay();

        // =============================================
        // SISTEMA DE COMBATE (MELHORADO)
        // =============================================

        const combatSystem = {
            startCombat: function(enemy) {
                isInCombat = true;
                currentEnemy = enemy;
                
                document.getElementById('combat-ui').classList.remove('hidden');
                document.getElementById('enemy-name').textContent = enemy.name;
                document.getElementById('enemy-level').textContent = `Nível: ${enemy.level}`;
                
                addMessage(`⚔️ **COMBATE INICIADO!** Você enfrenta ${enemy.name} (Nível ${enemy.level})!`, 'ai', 'combat');
            },
            
            playerAttack: function() {
                if (!isInCombat || !currentEnemy) return;
                
                // Dano baseado na força e destreza
                const baseDamage = 8 + Math.floor(attributes.strength / 2) + Math.floor(attributes.dexterity / 4);
                const damage = baseDamage + Math.floor(Math.random() * 8);
                
                addMessage(`💥 Você ataca ${currentEnemy.name} causando ${damage} de dano!`, 'ai', 'combat');
                
                setTimeout(() => {
                    // Inimigo contra-ataca com lógica coerente
                    const enemyDamage = 5 + Math.floor(Math.random() * 8);
                    localCharacterProfile.currentHP = Math.max(0, localCharacterProfile.currentHP - enemyDamage);
                    updateHealthBars();
                    
                    addMessage(`👹 ${currentEnemy.name} contra-ataca causando ${enemyDamage} de dano!`, 'ai', 'combat');
                    
                    // Verificar se o jogador foi derrotado
                    if (localCharacterProfile.currentHP <= 0) {
                        addMessage(`💀 Você foi derrotado por ${currentEnemy.name}! A aventura termina aqui...`, 'ai', 'combat');
                        endCombat(false);
                    }
                }, 1000);
            },
            
            endCombat: function(victory) {
                isInCombat = false;
                currentEnemy = null;
                
                document.getElementById('combat-ui').classList.add('hidden');
                document.getElementById('skills-section').classList.add('hidden');
                
                if (victory) {
                    const xpGained = 20 + Math.floor(Math.random() * 30);
                    gainXP(xpGained);
                    addMessage(`🎉 **VITÓRIA!** Você ganhou ${xpGained} de XP!`, 'ai', 'level-up');
                }
            }
        };

        function startCombat(enemy) {
            combatSystem.startCombat(enemy);
        }

        // Event Listeners de combate
        document.getElementById('attack-btn').addEventListener('click', () => combatSystem.playerAttack());
        document.getElementById('skill-btn').addEventListener('click', () => {
            document.getElementById('skills-section').classList.toggle('hidden');
        });
        document.getElementById('flee-btn').addEventListener('click', () => {
            if (isInCombat) {
                addMessage('🏃 Você fugiu do combate!', 'ai', 'combat');
                combatSystem.endCombat(false);
            }
        });

        // =============================================
        // INICIALIZAÇÃO DO JOGO
        // =============================================

        console.log(`
🎮 RPG TEXTUAL - SISTEMA COMPLETO

Modo Atual: ${gameMode}
Modo de História: ${storyMode}

SISTEMAS IMPLEMENTADOS:
✅ Barras de XP, HP e MP
✅ Sistema de atributos (Força, Destreza, Constituição, Inteligência, Sabedoria, Carisma)
✅ Árvore de habilidades com pontos
✅ Sistema de relacionamentos
✅ Dois modos de história singleplayer com histórias iniciais diferentes
✅ IA que não limita criatividade
✅ Inimigos com motivação coerente

Para multiplayer futuro:
1. Configure o Firebase
2. Adicione sistema de salas
3. Implemente sincronização

Divirta-se! 🎉
        `);

    </script>
</body>
</html>
